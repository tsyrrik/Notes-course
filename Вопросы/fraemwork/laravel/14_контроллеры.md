## Вопрос: Контроллеры: типы
Версия: Laravel 12.x (актуальная), 11.x в security-fixes; PHP 8.2–8.4.

## Простой ответ
Контроллеры — классы-обработчики запросов (обычные, ресурсные, API, одиночные).

## Ответ

Контроллеры — это классы, которые группируют логику обработки HTTP-запросов. Вместо того чтобы определять всю логику в замыканиях маршрутов, контроллеры организуют связанные обработчики в один класс. В Laravel контроллеры располагаются в `app/Http/Controllers/` и обычно наследуют базовый `Controller`.

**Типы контроллеров:**

**1. Обычный контроллер:**
```bash
php artisan make:controller UserController
```
```php
class UserController extends Controller
{
    public function index()
    {
        $users = User::paginate(20);
        return view('users.index', compact('users'));
    }

    public function show(User $user)
    {
        return view('users.show', compact('user'));
    }
}
```

**2. Resource Controller (CRUD)** — генерирует 7 стандартных методов:
```bash
php artisan make:controller PostController --resource
php artisan make:controller PostController --resource --model=Post  # с type-hint модели
```
```php
class PostController extends Controller
{
    public function index() {}      // GET    /posts           — список
    public function create() {}     // GET    /posts/create    — форма создания
    public function store(Request $request) {}  // POST   /posts           — сохранить
    public function show(Post $post) {}         // GET    /posts/{post}    — показать
    public function edit(Post $post) {}         // GET    /posts/{post}/edit — форма редактирования
    public function update(Request $request, Post $post) {} // PUT/PATCH /posts/{post} — обновить
    public function destroy(Post $post) {}      // DELETE /posts/{post}    — удалить
}

// Маршрут
Route::resource('posts', PostController::class);
```

**3. API Resource Controller** — без `create()` и `edit()` (формы не нужны в API):
```bash
php artisan make:controller Api/PostController --api
```
```php
class PostController extends Controller
{
    public function index()
    {
        return PostResource::collection(Post::paginate(20));
    }

    public function store(StorePostRequest $request)
    {
        $post = Post::create($request->validated());
        return new PostResource($post);
    }

    public function show(Post $post)
    {
        return new PostResource($post->load('comments'));
    }

    public function update(UpdatePostRequest $request, Post $post)
    {
        $post->update($request->validated());
        return new PostResource($post);
    }

    public function destroy(Post $post)
    {
        $post->delete();
        return response()->noContent(); // 204
    }
}

// Маршрут
Route::apiResource('posts', PostController::class);
```

**4. Invokable Controller (Single Action)** — контроллер с одним действием:
```bash
php artisan make:controller ExportUsersController --invokable
```
```php
class ExportUsersController extends Controller
{
    public function __invoke(Request $request)
    {
        $users = User::all();
        return Excel::download(new UsersExport($users), 'users.xlsx');
    }
}

// Маршрут — без указания метода
Route::get('/export/users', ExportUsersController::class);
```

**5. Контроллер с конструктором и DI:**
```php
class OrderController extends Controller
{
    public function __construct(
        private OrderService $orderService,
        private PaymentGateway $paymentGateway,
    ) {}

    public function store(StoreOrderRequest $request)
    {
        $order = $this->orderService->create($request->validated());
        $this->paymentGateway->charge($order);

        return redirect()->route('orders.show', $order)
            ->with('success', 'Заказ создан');
    }
}
```

**Middleware в контроллере:**
```php
class AdminController extends Controller
{
    public function __construct()
    {
        $this->middleware('auth');
        $this->middleware('admin')->except('index');
        $this->middleware('log')->only('store', 'update', 'destroy');
    }
}
```

**Практический совет:** держите контроллеры «тонкими» — каждый метод не более 10-15 строк. Бизнес-логику выносите в Service-классы или Action-классы. Используйте `--invokable` контроллеры для нестандартных действий (экспорт, импорт, webhook). Для API всегда используйте API Resource (`--api`) в сочетании с JsonResource для форматирования ответов. В Laravel 11 базовый `Controller` не содержит trait-ов `AuthorizesRequests` и `ValidatesRequests` по умолчанию — их нужно добавлять вручную при необходимости.

## Примеры

1. `php artisan make:controller PostController --resource`.
2. Resource‑контроллер с `index/show/store`.
3. Invokable‑контроллер: `__invoke()`.

## Доп. теория

1. Контроллеры должны быть тонкими, логика в сервисах.
2. Resource‑контроллеры дают стандартный CRUD.
