## Вопрос: Маршрутизация
Версия: Laravel 12.x (актуальная), 11.x в security-fixes; PHP 8.2–8.4.

## Простой ответ
Маршруты говорят Laravel какой URL обрабатывает какой контроллер/метод.

## Ответ

Маршрутизация (routing) — это механизм, который связывает URL-адреса с обработчиками (контроллерами или замыканиями). Когда Laravel получает HTTP-запрос, он ищет подходящий маршрут и вызывает соответствующий код. В Laravel 11 маршруты по умолчанию определяются в `routes/web.php` (для веб-страниц с сессиями и CSRF) и `routes/api.php` (для API, если подключён).

**В Laravel 11** файл `routes/api.php` не создаётся по умолчанию. Чтобы добавить API-маршруты, нужно выполнить `php artisan install:api`, который создаст файл и установит Laravel Sanctum.

**Основные HTTP-методы и синтаксис:**

```php
use App\Http\Controllers\UserController;

// Основные HTTP-методы
Route::get('/users', [UserController::class, 'index']);
Route::post('/users', [UserController::class, 'store']);
Route::put('/users/{user}', [UserController::class, 'update']);
Route::patch('/users/{user}', [UserController::class, 'update']);
Route::delete('/users/{user}', [UserController::class, 'destroy']);

// Несколько методов для одного маршрута
Route::match(['get', 'post'], '/form', [FormController::class, 'handle']);
Route::any('/webhook', [WebhookController::class, 'handle']);

// Замыкания (для простых маршрутов)
Route::get('/health', fn () => response()->json(['status' => 'ok']));

// Redirect и View без контроллера
Route::redirect('/old-page', '/new-page', 301);
Route::view('/about', 'pages.about', ['year' => 2024]);
```

**Параметры маршрутов:**

```php
// Обязательный параметр
Route::get('/users/{id}', [UserController::class, 'show']);

// Опциональный параметр
Route::get('/users/{name?}', function (?string $name = 'Guest') {
    return "Hello, {$name}";
});

// Ограничения параметров (regex)
Route::get('/users/{id}', [UserController::class, 'show'])->where('id', '[0-9]+');
Route::get('/posts/{slug}', [PostController::class, 'show'])->where('slug', '[a-z\-]+');

// Глобальные ограничения (в AppServiceProvider или RouteServiceProvider)
Route::pattern('id', '[0-9]+');  // для всех маршрутов с {id}

// Хелперы для типичных ограничений
Route::get('/users/{id}', [UserController::class, 'show'])->whereNumber('id');
Route::get('/posts/{slug}', [PostController::class, 'show'])->whereAlpha('slug');
Route::get('/items/{id}', [ItemController::class, 'show'])->whereUuid('id');
```

**Группировка маршрутов:**

```php
// Группа с middleware
Route::middleware(['auth', 'verified'])->group(function () {
    Route::get('/dashboard', [DashboardController::class, 'index']);
    Route::get('/profile', [ProfileController::class, 'edit']);
});

// Группа с prefix и name
Route::prefix('admin')
    ->name('admin.')
    ->middleware('auth:admin')
    ->group(function () {
        Route::get('/dashboard', [AdminController::class, 'dashboard'])->name('dashboard');
        Route::resource('users', AdminUserController::class);
        // URL: /admin/users, имя: admin.users.index
    });

// Группа с контроллером (Laravel 9+)
Route::controller(UserController::class)->group(function () {
    Route::get('/users', 'index');
    Route::post('/users', 'store');
    Route::get('/users/{user}', 'show');
});
```

**Resource и API Resource:**

```php
// Resource — генерирует 7 маршрутов (index, create, store, show, edit, update, destroy)
Route::resource('posts', PostController::class);

// API Resource — 5 маршрутов (без create и edit, т.к. это формы)
Route::apiResource('posts', PostController::class);

// Ограничить только нужные методы
Route::resource('posts', PostController::class)->only(['index', 'show']);
Route::resource('posts', PostController::class)->except(['destroy']);

// Вложенные ресурсы
Route::resource('posts.comments', CommentController::class)->shallow();
// /posts/{post}/comments, /comments/{comment}
```

**Fallback маршрут и список маршрутов:**

```php
// Fallback — обработка несуществующих URL
Route::fallback(function () {
    return response()->view('errors.404', [], 404);
});
```

```bash
# Просмотр всех маршрутов
php artisan route:list
php artisan route:list --path=api     # фильтр по пути
php artisan route:list --name=admin   # фильтр по имени
```

**Практический совет:** используйте `Route::resource()` и `Route::apiResource()` вместо ручного определения CRUD-маршрутов — это стандарт Laravel и уменьшает количество кода. В Laravel 11 для кэширования маршрутов используйте `php artisan route:cache` на production — это ускоряет регистрацию маршрутов в несколько раз. Всегда именуйте маршруты через `->name()` для удобной генерации URL.

## Примеры

1. `Route::get('/users', [UserController::class, 'index'])`.
2. `Route::resource('posts', PostController::class)`.
3. Параметры: `Route::get('/users/{id}', ...)`.

## Доп. теория

1. Кэш маршрутов ускоряет загрузку в prod.
2. Группы маршрутов упрощают middleware и префиксы.
