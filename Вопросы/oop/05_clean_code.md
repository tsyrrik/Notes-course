## Вопрос: Чистый код (Clean Code)

## Простой ответ
- Пиши так, чтобы через полгода ты/коллега быстро поняли, что происходит, и могли безопасно поменять.

```php
// Плохо
function p($a,$b){return $a+$b;}

// Лучше
function sumPrices(int $net, int $tax): int {
    return $net + $tax;
}
```

## Ответ

### Основные принципы (по Роберту Мартину)

**1. Именование**
- Имена переменных/методов/классов должны объяснять назначение
- Избегайте аббревиатур и однобуквенных имён (кроме `$i` в циклах)
- Классы — существительные (`UserRepository`), методы — глаголы (`findById`)

```php
// Плохо
$d = $u->calc($t, $p);

// Хорошо
$discount = $order->calculateDiscount($total, $promoCode);
```

**2. Функции/методы**
- Делают **одну вещь** (Single Responsibility)
- Маленькие: 5-20 строк — идеал, >30 — рефакторить
- Не более 3 аргументов (иначе — объект параметров / DTO)
- Без побочных эффектов (side effects)

**3. Комментарии**
- Хороший код **не нуждается** в комментариях — имена объясняют
- Комментарий оправдан: пояснение бизнес-правила, ссылка на RFC/задачу, TODO, предупреждение
- **Запрет**: закомментированный код, очевидные комментарии (`// increment counter`)

**4. Форматирование**
- Единый стиль в проекте (PSR-12 / PER)
- Пустые строки между логическими блоками
- Связанные методы — рядом, публичные — сверху

**5. Обработка ошибок**
- Исключения вместо кодов возврата
- Не возвращайте `null` если можно вернуть пустую коллекцию или `Optional`
- Fail fast — проверяйте входные данные в начале

### KISS, DRY, YAGNI

| Принцип | Расшифровка | Суть |
| --- | --- | --- |
| **KISS** | Keep It Simple, Stupid | Простейшее решение — лучшее |
| **DRY** | Don't Repeat Yourself | Не дублируйте знание (но дублирование кода ≠ нарушение DRY) |
| **YAGNI** | You Ain't Gonna Need It | Не пишите код «на будущее» |

### Boy Scout Rule

> «Оставь код чище, чем нашёл» — делайте мелкие улучшения при каждом касании файла.

### Пример рефакторинга

```php
// Плохо: большой метод, непонятные имена
function proc($data) {
    $r = [];
    foreach ($data as $d) {
        if ($d['t'] == 1 && $d['a'] > 100) {
            $r[] = $d['a'] * 0.9;
        }
    }
    return $r;
}

// Хорошо: понятные имена, маленькие методы
function getDiscountedPrices(array $orders): array {
    return array_map(
        fn(array $order) => $order['amount'] * 0.9,
        array_filter($orders, fn(array $order) => $this->isEligibleForDiscount($order))
    );
}

private function isEligibleForDiscount(array $order): bool {
    return $order['type'] === OrderType::Premium->value
        && $order['amount'] > self::DISCOUNT_THRESHOLD;
}
```

## Примеры
```text
Плохое имя: doIt(); хорошее имя: calculateInvoiceTotal().
```

## Доп. теория
- «Чистый код» зависит от контекста и команды, но цель — читаемость и безопасные изменения.
- Автоформаттеры и линтеры помогают поддерживать единый стиль.
