## Вопрос: Redis

## Простой ответ
Redis - это in-memory key-value хранилище с опциональной персистентностью, поддержкой множества структур данных и возможностью работать как кэш, брокер сообщений и быстрая база для временных данных.

## Ответ
Redis - это in-memory key-value хранилище с опциональной персистентностью, поддержкой множества структур данных и возможностью работать как кэш, брокер сообщений и быстрая база для временных данных.

## Ключевые особенности
- **Память + диск**: данные держатся в оперативной памяти; персистентность через RDB (снимки) и AOF (журнал команд).
- **Структуры данных**: строки, списки, множества, сортированные множества, хэши, битмапы, гиперлоглоги, стримы.
- **Низкая задержка**: операции миллисекундного уровня, одним потоком (epoll), плюс pipeline для пакетных операций.
- **TTL**: истечение ключей, удобно для кэша и временных данных.
- **Репликация и кластер**: master-replica и Redis Cluster с шардингом по хеш-слотам.

## Типовые сценарии
- **Кэширование** результатов запросов и API; хранения сессий.
- **Очереди/брокер**: списки (`LPUSH`/`BRPOP`), стримы (`XADD`/`XREADGROUP`), pub/sub.
- **Счетчики и rate limiting**: инкременты, токен-бакеты, sliding window.
- **Лидеры/рейтинги**: сортированные множества (`ZADD`, `ZRANGE`).
- **Блокировки**: простая `SET key value NX PX ttl` или Redlock (с оговорками).

## Персистентность
- **RDB**: периодические снимки; быстрый рестарт, но возможна потеря последних секунд/минут.
- **AOF**: журнал всех команд; `appendfsync` опции `always`/`everysec`/`no` - баланс между безопасностью и производительностью.
- Часто используют гибрид: RDB + AOF (rewrites) для ускорения загрузки и снижения размера журнала.

## Репликация и отказоустойчивость
- **Replica**: асинхронные копии master; есть `replica-read` для разгрузки чтения.
- **Sentinel**: мониторинг мастера и автоматический failover.
- **Cluster**: горизонтальный шардинг на 16384 слота, редиректы `MOVED`/`ASK`, без транзакций multi-key за пределами одного слота.

## Безопасность и конфигурация
- Минимально: пароль (`requirepass`), `bind`, `protected-mode`, TLS при необходимости.
- Лимиты памяти: `maxmemory` и политика вытеснения (`allkeys-lru`, `volatile-lru`, `noeviction` и др.).
- Следить за `SLOWLOG`, `INFO`, метриками памяти и фрагментации.

## Когда Redis не подходит
- Данные не помещаются в память и требуется постоянное долговечное хранилище.
- Нужны сложные запросы, joins, транзакции ACID или аналитика.
- Требуются строгие гарантии доставки/маршрутизации сообщений (лучше RabbitMQ/Kafka).

## Примеры команд
```
SET key value EX 60             # запись с TTL 60s
HSET user:1 name "Ann"          # хэш
LPUSH queue "task-1"            # очередь на списках
BRPOP queue 0                   # блокирующее чтение
XADD stream * f1 v1             # запись в стрим
XREADGROUP GROUP g c BLOCK 0 STREAMS stream >  # чтение из группы
ZADD leaderboard 100 user1      # рейтинг
INCR counter                    # атомарный счетчик
```

## Примеры
```bash
SET user:1 "Alice" EX 3600
GET user:1
```

## Доп. теория
- Redis чаще используют как кэш/брокер, а не как primary‑БД.
- Персистентность Redis — компромисс между скоростью и риском потери данных.
