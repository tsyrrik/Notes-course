## Вопрос: Влияние порядка столбцов на размер таблицы (PostgreSQL)

## Простой ответ
- Порядок колонок влияет на выравнивание и плотность строк. Ставьте фиксированные типы (int/bool/timestamp) в начало, переменные (text/jsonb) — в конец, длинные/редкие — в хвост.

## Ответ
## Почему это важно
- Строка хранится как байтовый буфер (tuple) в странице 8KB с header, фиксированными полями, потом varlena-смещения/данные.
- Выравнивание: int4/int8/float/timestamp требуют границ 4/8 байт. Если перед ними varlena (text), вставляется padding → лишние байты.
- Varlen (text/varchar/jsonb/array) имеют свой header и могут уходить в TOAST. При размещении в конце проще обрезать/сжать без сдвигов.

## Правило раскладки
1) Фиксированные типы (int, bool, timestamp, numeric small) — в начале.  
2) Переменные (varchar/text/jsonb/bytea/uuid) — после них.  
3) Очень длинные/редко используемые поля — в самом хвосте (проще не трогать при чтении, компактнее TOAST).

Избегайте varlena между int/float/timestamp, иначе появляется padding по 4–8 байт в каждой строке.

## Эффект
- Меньше padding → компактнее строки → меньше страниц → больше кеш-хитов, меньше I/O.  
- UPDATE копирует tuple; короткие плотные строки дешевле.  
- Фиксированные поля в начале — быстрее вычисляется смещение.

## Пример разницы
```sql
-- Хорошо
CREATE TABLE good (
  id bigserial,
  created_at timestamp,
  active boolean,
  email varchar(255),
  bio text
);

-- Плохо
CREATE TABLE bad (
  email varchar(255),
  id bigserial,
  bio text,
  created_at timestamp,
  active boolean
);
-- pg_total_relation_size('bad') будет больше на тех же данных из-за padding/фрагментации.
```

## Запомнить просто
“Сначала короткое и ровное, потом то, что растёт и сжимается”.  
То есть: фиксированные → переменные → длинные/редкие. На больших объёмах экономит гигабайты и время.

## Примеры
```sql
CREATE TABLE good (
  id bigserial,
  created_at timestamp,
  active boolean,
  email varchar(255),
  bio text
);
```

## Доп. теория
- В PostgreSQL переменные поля (varlena) могут выноситься в TOAST, что снижает нагрузку на основную страницу.
- Порядок столбцов влияет на padding и, как следствие, на размер строки.
