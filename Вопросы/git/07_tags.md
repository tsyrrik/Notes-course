## Вопрос: Теги (tags)

## Простой ответ
- Теги помечают важные коммиты (обычно релизы).
- Есть аннотированные (с сообщением/подписью) и лёгкие (просто ссылка).

```bash
git tag v1.0.0                # лёгкий тег
git tag -a v1.0.0 -m "release v1.0.0"   # аннотированный
git push origin v1.0.0        # отправить тег
git push --tags               # отправить все теги
```

Удаление/перенос:
```bash
git tag -d v1.0.0             # удалить локально
git push origin :refs/tags/v1.0.0  # удалить в удалённом
```

## Ответ

### Что такое теги

Теги в Git — это именованные ссылки на конкретные коммиты, используемые для пометки важных точек в истории проекта (релизы, версии, milestones). В отличие от веток, теги не перемещаются при новых коммитах — они всегда указывают на один и тот же коммит.

### Два вида тегов

**Lightweight (лёгкий)** — просто ссылка (указатель) на коммит. Не содержит метаданных. По сути, это именованный alias для хэша коммита.

**Annotated (аннотированный)** — полноценный объект Git, который хранит имя автора, дату, сообщение и опционально GPG-подпись. Рекомендуется для релизов, потому что несёт больше информации.

```bash
# Лёгкий тег
git tag v1.0.0

# Аннотированный тег
git tag -a v1.0.0 -m "Release v1.0.0: стабильная версия"

# Аннотированный тег с GPG-подписью
git tag -s v1.0.0 -m "Signed release v1.0.0"

# Тег на конкретный коммит (не обязательно HEAD)
git tag -a v0.9.0 abc1234 -m "Ретроспективный тег"
```

### Сравнение типов тегов

| Характеристика | Lightweight | Annotated |
|---|---|---|
| Метаданные (автор, дата) | Нет | Да |
| Сообщение | Нет | Да |
| GPG-подпись | Нет | Да |
| Объект в Git | Нет (только ref) | Да (tag object) |
| Показ через `git show` | Показывает коммит | Показывает тег + коммит |
| Использование | Временные/личные пометки | Релизы, версии |

### Работа с тегами

```bash
# Список всех тегов
git tag

# Список тегов по шаблону
git tag -l "v2.*"

# Информация о теге
git show v1.0.0

# Список тегов с датами и сообщениями
git tag -l --format='%(refname:short) %(creatordate:short) %(subject)'

# Сортировка тегов по версии (semver)
git tag -l --sort=-version:refname "v*"
```

### Push/pull тегов

По умолчанию `git push` не отправляет теги — их нужно пушить явно:

```bash
# Отправить конкретный тег
git push origin v1.0.0

# Отправить все теги
git push --tags

# Отправить только аннотированные теги (рекомендуется)
git push --follow-tags

# Получить теги с remote
git fetch --tags

# Настройка: автоматически пушить аннотированные теги
git config --global push.followTags true
```

### Удаление и перемещение тегов

```bash
# Удалить локально
git tag -d v1.0.0

# Удалить на remote
git push origin --delete v1.0.0
# или
git push origin :refs/tags/v1.0.0

# Переместить тег на другой коммит (не рекомендуется для опубликованных)
git tag -f v1.0.0 <new-commit-hash>
git push origin -f v1.0.0
```

### Семантическое версионирование (SemVer)

Стандартная схема именования тегов — [Semantic Versioning](https://semver.org/): `vMAJOR.MINOR.PATCH`

| Компонент | Когда инкрементировать | Пример |
|---|---|---|
| MAJOR | Несовместимые изменения API | v1.0.0 → v2.0.0 |
| MINOR | Новая функциональность (обратно совместимая) | v1.0.0 → v1.1.0 |
| PATCH | Исправление багов | v1.0.0 → v1.0.1 |

Дополнительные суффиксы: `v1.0.0-alpha`, `v1.0.0-beta.1`, `v1.0.0-rc.1`

### Теги в CI/CD

Теги часто используются как триггеры для автоматических релизов:

```yaml
# GitHub Actions — deploy при создании тега
on:
  push:
    tags:
      - 'v*'

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Build and deploy
        run: make release VERSION=${{ github.ref_name }}
```

```bash
# Получить текущий тег (для скриптов)
git describe --tags --abbrev=0         # ближайший тег: v1.2.3
git describe --tags                     # тег + расстояние: v1.2.3-5-gabc1234
```

### Checkout на тег

```bash
# Переключиться на тег (detached HEAD)
git checkout v1.0.0

# Создать ветку от тега (для hotfix)
git checkout -b hotfix/v1.0.1 v1.0.0
```

## Примеры
```bash
git tag -a v1.0.0 -m "release"
git push --follow-tags
```

## Доп. теория
- Для релизов предпочтительны аннотированные теги.
- Не перемещайте опубликованные теги без крайней необходимости.
