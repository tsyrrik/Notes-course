# Микросервисы: плюсы/минусы, выбор, сценарии

## Простыми словами
- Монолит — один большой сервис и БД: просто стартовать, но релизы и масштаб — целиком.
- Микросервисы — много маленьких с отдельными БД: гибкие релизы и масштаб, но растёт сложность сети/инфры.
- Дробить оправдано, если есть разные темпы релизов, нагрузки и чёткие границы домена.
- Монолит (+): проще деплой/отладка/транзакции, единый код/БД, меньше DevOps‑нагрузки.
- Монолит (−): релизы «по всему», масштабирование только целиком, узкое горлышко команды и CI.
- Микросервисы (+): независимые релизы и масштабирование, изоляция отказов, технологическая гибкость, ownership по доменам.
- Микросервисы (−): сеть/latency, распределённые транзакции, рост инфраструктуры (оркестрация, observability, сервис‑мэш), дублирование данных/логики.

## Когда оставить монолит
- Ранний продукт, быстрый цикл фич, маленькая команда.
- Сильно связанный домен: бизнес‑операции требуют «жёстких» транзакций и общей схемы.
- Нет зрелого CI/CD/мониторинга/алертинга — микросервисы только усилят хаос.

## Когда делить на микросервисы
- Разные темпы релизов/жизненные циклы: биллинг vs уведомления vs каталоги.
- Разные нелинейные нагрузки: поиск/каталог (горячие чтения) vs оплата (строгие записи).
- Чёткие bounded contexts и отдельные команды/SLAs; требование технологической изоляции.
- Гео/регуляторика: данные/функции должны жить отдельно.

## Как пилить монолит (Strangler)
- Выбрать кандидат‑функцию с понятными границами и потребностью в независимом масштабе/релизах.
- Описать контракт: API/gRPC для команд + события для реакций; спроектировать модель данных.
- Выделить собственную БД; добавить анти‑коррапшн слой в монолите; фича‑флаг.
- Отрезать маршрутизацию на новый сервис, очистить код в монолите.

## Коммуникации и согласованность
- Команды: HTTP/gRPC; реакции/интеграции: события.
- Согласованность: Saga/Outbox; каденс событий и идемпотентность на потребителях.

```text
User Service (DB users)
  POST /users {email, name}
  emits event user.created

Notifications Service (DB notifications)
  consumes user.created -> send welcome email
```
