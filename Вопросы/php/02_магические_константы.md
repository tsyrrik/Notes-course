## Вопрос: Магические константы PHP
Версия: PHP 8.4; где есть исторические детали — см. по тексту.

## Простой ответ
предопределённые “служебные” идентификаторы, которые PHP подставляет во время исполнения; начинаются и заканчиваются двойным подчёркиванием.

## Ответ

Магические константы — это специальные идентификаторы, значение которых PHP определяет в момент компиляции/выполнения в зависимости от контекста использования. В отличие от обычных констант (`define`/`const`), их значение не фиксировано.

| Константа | Описание | Пример значения |
| --- | --- | --- |
| `__LINE__` | Номер текущей строки в файле | `42` |
| `__FILE__` | Полный путь к файлу (с разрешёнными симлинками) | `/var/www/app/User.php` |
| `__DIR__` | Каталог файла (= `dirname(__FILE__)`) | `/var/www/app` |
| `__FUNCTION__` | Имя функции (без класса) | `doSomething` |
| `__METHOD__` | Имя метода с классом | `App\User::doSomething` |
| `__CLASS__` | Имя класса (с namespace) | `App\User` |
| `__TRAIT__` | Имя трейта (с namespace) | `App\Traits\HasName` |
| `__PROPERTY__` | Имя свойства (только внутри property hooks) | `email` |
| `__NAMESPACE__` | Текущее пространство имён | `App\Services` |
| `ClassName::class` | Полное имя класса (FQCN) | `App\User` |

### Нюансы

- `__CLASS__` внутри трейта вернёт имя класса, **использующего** трейт, а не имя самого трейта. Для получения имени трейта используйте `__TRAIT__`.
- `__FUNCTION__` внутри анонимной функции возвращает `{closure}`.
- `__DIR__` не содержит завершающий слэш (кроме корневого каталога).
- `__FILE__` разрешает симлинки — возвращает реальный путь.
- Эти константы регистронезависимы: `__line__` и `__LINE__` — одно и то же.
- `__PROPERTY__` доступна только внутри property hooks (PHP 8.4+).
- `ClassName::class` — не магическая константа, а compile-time разрешение FQCN.

### Практическое применение

- **Автозагрузка**: `__DIR__` часто используется в `autoload.php` для построения путей.
- **Логирование**: `__FILE__` + `__LINE__` + `__METHOD__` для точного указания места ошибки.
- **Отладка**: быстрый `echo __METHOD__ . ':' . __LINE__` вместо xdebug.

## Примеры

```php
// Логирование с указанием места
function logError(string $msg): void {
    error_log(sprintf('[%s:%d] %s', __FILE__, __LINE__, $msg));
}

// Автозагрузка относительно текущего файла
require_once __DIR__ . '/../vendor/autoload.php';

// Трейт: __CLASS__ vs __TRAIT__
trait Loggable {
    public function log(): void {
        echo __CLASS__;  // App\User (класс, использующий трейт)
        echo __TRAIT__;  // App\Traits\Loggable
    }
}

class User {
    use Loggable;
}
(new User())->log();
```

## Доп. теория
- Значения магических констант определяются во время компиляции и зависят от контекста (файл/класс/функция). Для `__FILE__` и `__DIR__` это путь до файла, где они используются.
- `__FUNCTION__` внутри анонимной функции возвращает `{closure}` — это полезно для логирования.
