## Вопрос: Рефлексия
Версия: PHP 8.4; где есть исторические детали — см. по тексту.

## Простой ответ
API для изучения и (иногда) изменения кода во время выполнения. Позволяет узнать методы/свойства/типы/атрибуты и работать с ними.

## Ответ

Рефлексия (Reflection API) — встроенный механизм PHP для интроспекции кода во время выполнения. Позволяет анализировать и модифицировать структуру классов, функций, свойств, параметров и атрибутов.

### Основные классы Reflection API

| Класс | Что анализирует |
| --- | --- |
| `ReflectionClass` | Классы, интерфейсы, трейты, enum |
| `ReflectionMethod` | Методы класса |
| `ReflectionProperty` | Свойства класса |
| `ReflectionFunction` | Функции (включая замыкания) |
| `ReflectionParameter` | Параметры функций/методов |
| `ReflectionType` | Объявления типов |
| `ReflectionAttribute` | Атрибуты (PHP 8.0+) |
| `ReflectionEnum` | Перечисления (PHP 8.1+) |
| `ReflectionFiber` | Файберы (PHP 8.1+) |

### Практическое применение

## Примеры
**DI-контейнеры** — автоматическое разрешение зависимостей через анализ конструктора:
```php
function resolve(string $class): object {
    $ref = new ReflectionClass($class);
    $constructor = $ref->getConstructor();

    if (!$constructor) {
        return new $class();
    }

    $args = [];
    foreach ($constructor->getParameters() as $param) {
        $type = $param->getType()?->getName();
        $args[] = resolve($type); // рекурсивно
    }

    return $ref->newInstanceArgs($args);
}
```

**Чтение атрибутов (PHP 8.0+)**:
```php
#[Route('/users', methods: ['GET'])]
class UserController {
    #[Cache(ttl: 3600)]
    public function index(): Response { /* ... */ }
}

$ref = new ReflectionClass(UserController::class);
$attrs = $ref->getAttributes(Route::class);
foreach ($attrs as $attr) {
    $route = $attr->newInstance(); // Route object
    echo $route->path; // /users
}
```

**Анализ структуры класса**:
```php
$ref = new ReflectionClass(DateTime::class);
echo $ref->getShortName();           // DateTime
echo $ref->getNamespaceName();       // '' (глобальный)
echo $ref->isInstantiable();         // true
echo $ref->getMethod('format')->isPublic(); // true

// Все публичные методы
$methods = $ref->getMethods(ReflectionMethod::IS_PUBLIC);
```

## Доп. теория
- Рефлексия относительно медленная — результаты нужно кешировать (как делают DI‑контейнеры, ORM).
- Используйте её в инфраструктурном коде, а не в горячих путях.
