## Вопрос: Автозагрузка классов
Версия: PHP 8.4; где есть исторические детали — см. по тексту.

## Простой ответ
не подключаем файлы руками — Composer (PSR-4) или свой автозагрузчик подгружает класс при первом `use/new`.

## Ответ

Автозагрузка — механизм, при котором PHP автоматически подключает файл с определением класса при первом обращении к нему (`new`, type-hint, `::class`). Без автозагрузки пришлось бы вручную писать `require` для каждого файла.

### Как работает

1. PHP встречает неизвестный класс → вызывает зарегистрированные autoload-функции по очереди.
2. Autoloader ищет файл по имени класса → подключает его через `require`.
3. Если класс не найден ни одним autoloader'ом → `Fatal error: Class not found`.

### spl_autoload_register()

Базовый PHP-механизм для регистрации автозагрузчиков:

```php
spl_autoload_register(function (string $class): void {
    $file = __DIR__ . '/src/' . str_replace('\\', '/', $class) . '.php';
    if (file_exists($file)) {
        require $file;
    }
});

// Теперь new App\Services\Mailer() загрузит src/App/Services/Mailer.php
```

### Composer autoload (рекомендуемый подход)

Composer предоставляет несколько стратегий:

| Стратегия | Описание | Скорость |
| --- | --- | --- |
| **PSR-4** | Namespace → каталог | Быстрая (стандарт) |
| **PSR-0** | Устарел, заменён PSR-4 | — |
| **classmap** | Сканирует файлы, строит полную карту | Самая быстрая |
| **files** | Подключает файлы безусловно (helpers) | Всегда загружены |

```json
{
  "autoload": {
    "psr-4": { "App\\": "src/" },
    "files": ["src/helpers.php"]
  }
}
```

### Оптимизация в production

```bash
# Генерирует classmap из PSR-4 — ускоряет загрузку
composer dump-autoload --optimize

# Или при install
composer install --optimize-autoloader --no-dev
```

`--optimize` сканирует все файлы и создаёт полную карту класс → файл. В dev-режиме не нужен — замедляет `dump-autoload` и не отслеживает новые файлы.

### Порядок вызова автозагрузчиков

Можно зарегистрировать несколько autoloader'ов — они вызываются в порядке регистрации. Composer регистрирует свой первым. Если autoloader нашёл класс — последующие не вызываются.

## Примеры
```php
// Простейший автолоадер
spl_autoload_register(function (string $class): void {
    $path = __DIR__ . '/src/' . str_replace('\\', '/', $class) . '.php';
    if (is_file($path)) {
        require $path;
    }
});
```

```bash
# оптимизация автозагрузки в проде
composer dump-autoload -o
```

## Доп. теория
- PSR‑4 — де‑факто стандарт, PSR‑0 считается устаревшим.
- `files` автозагрузка используется для функций‑хелперов, которые всегда должны быть доступны.
