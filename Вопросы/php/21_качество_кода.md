## Вопрос: Качество кода
Версия: PHP 8.4; где есть исторические детали — см. по тексту.

## Простой ответ
держим код читабельным, проверяемым и стабильным. Комбинация процессов + инструментов.

## Ответ

Качество кода — комплекс практик, процессов и инструментов, обеспечивающих читаемость, надёжность и поддерживаемость проекта.

### Процессы

- **Code Review** — проверка кода коллегами перед мержем. Главный инструмент повышения качества.
- **Тесты** — unit, integration, functional, e2e. Подтверждают работоспособность кода.
- **CI/CD** — автоматический запуск тестов, линтеров и анализаторов при каждом коммите.
- **Pair Programming** — совместная работа двух разработчиков, хорошо для сложных задач и онбординга.
- **Clean Code** — принципы чистого кода: понятные имена, маленькие функции, единая ответственность.

### Инструменты для PHP

| Инструмент | Назначение | Что делает |
| --- | --- | --- |
| **PHPStan** | Статический анализ | Находит баги без запуска кода (9 уровней строгости) |
| **Psalm** | Статический анализ | Альтернатива PHPStan, фокус на типах |
| **PHP-CS-Fixer** | Форматирование | Автоматическое исправление стиля кода (PSR-12, PER) |
| **PHPCS** | Стиль кода | Проверяет (и phpcsf — исправляет) нарушения стиля |
| **PHPUnit** | Тестирование | Unit и integration тесты |
| **Rector** | Рефакторинг | Автоматическое обновление кода (миграция PHP-версий, паттерны) |
| **Infection** | Мутационное тестирование | Проверяет качество тестов, внося мутации в код |
| **PHPMD** | Метрики | Обнаружение сложного/проблемного кода (cyclomatic complexity) |
| **Deptrac** | Архитектура | Контроль зависимостей между слоями |

### Минимальный CI pipeline

```yaml
# .github/workflows/ci.yml (пример)
steps:
  - run: composer install
  - run: vendor/bin/phpstan analyse --level=6
  - run: vendor/bin/php-cs-fixer fix --dry-run --diff
  - run: vendor/bin/phpunit --coverage-text
```

### Метрики качества

- **Code coverage** — процент кода, покрытого тестами (цель: 70-80%, 100% нереалистично)
- **Cyclomatic complexity** — количество путей выполнения (> 10 — нужен рефакторинг)
- **Mutation Score Indicator (MSI)** — процент мутантов, убитых тестами

## Примеры
```yaml
# пример GitHub Actions job
steps:
  - run: composer install --no-interaction --prefer-dist
  - run: vendor/bin/phpstan analyse --level=6
  - run: vendor/bin/phpunit
```

## Доп. теория
- Стандарты код-стайла лучше фиксировать в CI и автформаттером, а не ревью.
- Сначала добиваются стабильных тестов и статанализа, потом поднимают пороги качества.
