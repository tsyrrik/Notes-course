
**Распределённая транзакция** — это попытка выполнить **единый атомарный набор операций**  
в нескольких независимых системах (базах, сервисах, очередях и т. п.)  
так, чтобы всё вместе закоммитилось или всё откатилось.

---

### 1. Зачем это вообще

Если один бизнес-процесс затрагивает несколько источников данных:

- сохранить заказ в PostgreSQL,
    
- списать деньги через платежку,
    
- записать событие в Kafka,
    

— то нужно, чтобы они все либо прошли, либо нет.  
Для этого и придуманы распределённые транзакции.

---

### 2. Как это работает (в теории)

Классический механизм — **двухфазный коммит (2PC)**:

1. **Prepare phase** — все участники говорят “готовы ли вы закоммитить”.
    
2. **Commit phase** — координатор решает: либо коммитить всем, либо откатывать всем.
    

Но в распределённой среде (сетевые лаги, таймауты, рестарты)  
это часто ведёт к блокировкам и тупикам.  
Поэтому 2PC живёт в банках и мейнфреймах, а не в веб-приложениях.

---

### 3. Что вместо

Современные системы вместо настоящих распределённых транзакций используют:

- **Saga** — координация и компенсации вместо глобального коммита.
    
- **Outbox pattern** — локальная транзакция + фоновая отправка события.
    
- **Idempotent operations** — повторяемость без дублей.
    

---

### 4. В одной фразе

> Распределённые транзакции — это идея “всё или ничего” в масштабе сети,  
> от которой почти все сбежали к Saga и Outbox ради здравого смысла.