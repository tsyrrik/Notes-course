
**Inversion of Control (инверсия управления)** — это принцип, по которому **объекты не сами контролируют процесс выполнения**, а **получают поведение извне**.

Если коротко — **объект перестаёт решать, _кого вызывать_ и _когда_, а просто предоставляет себя в распоряжение внешней системы.**

---

### 1. Проблема до IoC

Без инверсии каждый объект управляет всем сам:

```php
class CheckoutService
{
    public function process(Order $order): void
    {
        $gateway = new PaypalPaymentGateway();
        $gateway->send($order->getTotal());
    }
}
```

Тут `CheckoutService` сам создаёт зависимости и управляет ими.  
Он контролирует процесс.  
Такой код невозможно переиспользовать или подменить.

---

### 2. Суть инверсии управления

IoC переворачивает схему:  
теперь **контроль за жизненным циклом и связями объектов уходит наружу** — например, фреймворку, контейнеру или внешней функции.

```php
class CheckoutService
{
    public function __construct(private PaymentGatewayInterface $gateway) {}

    public function process(Order $order): void
    {
        $this->gateway->send($order->getTotal());
    }
}
```

Теперь `CheckoutService` **не знает, как именно создаётся `gateway`** — ему просто передают готовую зависимость.  
Кто передаёт? Контейнер, фреймворк или вручную вызывающий код.  
**Он управляет зависимостями, а не сам объект.**

---

### 3. IoC vs Dependency Injection

Эти понятия часто путают.

- **IoC** — это общий принцип: «код не управляет собой, им управляют».
    
- **Dependency Injection (DI)** — конкретный способ реализовать IoC.  
    Когда зависимости _внедряются_ в класс (через конструктор, сеттер или аргументы метода), а не создаются внутри.
    

```php
// IoC реализован через DI
$service = new CheckoutService(new StripePaymentGateway());
```

---

### 4. Другие формы IoC

Инверсия управления — не только про зависимости.  
Она встречается в разных паттернах:

|Пример|Кто контролирует выполнение|
|---|---|
|Event loop|цикл вызывает твои callbacks|
|Framework lifecycle|фреймворк вызывает твои контроллеры|
|Dependency Injection|контейнер создаёт и внедряет классы|
|Observer|подписчики вызываются извне, не сами себя дергают|
