# Потоки ввода-вывода (STDIN, STDOUT, STDERR)

Базовые потоки процесса в Unix-подобных ОС:
- `STDIN` (fd 0) — стандартный ввод.
- `STDOUT` (fd 1) — стандартный вывод.
- `STDERR` (fd 2) — стандартный вывод ошибок (отдельно от STDOUT).

Любую программу можно запускать с перенаправлениями потоков: писать вывод в файл, подавлять его, отправлять в другой процесс и т.д. Это основа конвейеров и скриптинга.

## Перенаправления

- Запись стандартного вывода в файл (перезапись/добавление):
  - `ls -la > out.txt` — перезапишет файл.
  - `ls -la >> out.txt` — добавит в конец.
- Запись ошибок отдельно:
  - `cmd 2> errors.log` — только STDERR в файл.
- Объединение потоков:
  - `cmd > all.log 2>&1` — сначала отправить STDOUT в файл, затем STDERR в STDOUT (итог: оба в файл).
  - Bash-шорткат: `cmd &> all.log` (эквивалентно `> file 2>&1`).
- Порядок имеет значение:
  - `cmd 2>&1 >/dev/null` — STDERR скопирован в текущий STDOUT (терминал), а затем STDOUT спрятан; ошибки останутся на экране.
  - `cmd >/dev/null 2>&1` — оба потока скрыты (тихий запуск).
- Отправить вывод «в никуда»:
  - `cmd >/dev/null 2>&1` — полезно в cron/службах, чтобы не копить шум.

## STDIN и конвейеры (pipeline)

- Пайп `|` соединяет `STDOUT` слева с `STDIN` справа:
  - `cat access.log | grep 500 | sort | uniq -c | sort -nr | head`
- Включить ошибки в конвейер:
  - `cmd 2>&1 | grep ERROR` — объединить потоки перед пайпом.
  - Bash 4+: `cmd |& grep ERROR` — шорткат для `2>&1 |`.
- Захват выхода в переменную:
  - `OUT=$(cmd args)` — в переменную попадёт STDOUT; STDERR — нет.

## Надёжность пайпов и буферизация

- Корректный код возврата конвейера:
  - `set -o pipefail` — пусть код возврата пайпа равен коду возврата первого упавшего звена.
  - Часто вместе: `set -euo pipefail` (ошибки останавливают скрипт, неиспользуемые переменные — ошибка).

## Фон, демоны и сессии

- Запуск в фоне с отделением от терминала:
  - `nohup cmd >/var/log/cmd.out 2>&1 & disown`
- Для системных служб используйте `systemd` юниты с логами в `journalctl`.

## Краткий справочник по дескрипторам

- `0` — STDIN; `1` — STDOUT; `2` — STDERR.
- Примеры:
  - `2>&1` — направить STDERR (2) в STDOUT (1).
  - `1>&2` — направить STDOUT (1) в STDERR (2).
  - `exec >file 2>&1` — перенаправить потоки для всего текущего шелла.

## См. также
 - [[Пайпы и конвейеры (pipeline)]]
 - [[Частые команды Linux]]
 
