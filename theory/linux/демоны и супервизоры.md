### **Демоны (daemons)**

Демон — это фоновый процесс, работающий без привязки к терминалу.  
Название придумали ещё в 60-х, от греческих духов-помощников, которые тихо выполняют грязную работу за богов.  
В Linux — за тебя.

#### Примеры демонов:

- `sshd` — держит SSH-подключения
    
- `nginx` — слушает порты и кидает запросы в php-fpm
    
- `php-fpm` — сам тоже демон, управляющий своими воркерами
    
- `cron`, `systemd`, `rsyslogd`, `mysqld` — тоже всё демоны
    

Когда ты запускаешь сервис через systemctl, он поднимает процесс в фоне, отвязывает от терминала и пишет PID в файл.  
Всё, демон живёт своей жизнью — даже если ты выйдешь из SSH-сессии.

---

### **Супервизоры**

Теперь, раз у нас есть орда демонов, кто-то должен следить, чтобы они не разбежались.  
Вот этим занимаются супервизоры — менеджеры фоновых процессов.

Их задача простая: **запустить, перезапускать, логировать и контролировать** демоны, которые могут упасть, зависнуть или застрять в мёртвом цикле.

#### Самые известные:

|Инструмент|Кратко|
|---|---|
|**systemd**|Современный стандарт Linux. Управляет всем: службами, юнитами, зависимостями, логами через journalctl.|
|**supervisord**|Старый добрый Python-демон. Удобен в контейнерах и dev-окружениях. Конфиг простой, перезапуск по `autostart=true, autorestart=true`.|
|**runit**, **s6**, **monit**|Лёгкие альтернативы, популярны в минимальных системах.|
|**Docker**, **Kubernetes**|По сути, супервизоры нового поколения: следят за контейнерами и перезапускают их, если упали.|

---

### **Как они работают**

Пример systemd-юнита для php-fpm:

```ini
[Unit]
Description=PHP-FPM service
After=network.target

[Service]
Type=notify
ExecStart=/usr/sbin/php-fpm --nodaemonize --fpm-config /etc/php-fpm.conf
ExecReload=/bin/kill -USR2 $MAINPID
Restart=always
RestartSec=3

[Install]
WantedBy=multi-user.target
```

Systemd поднимает процесс, следит за ним и перезапускает, если тот ушёл в небытие.  
То есть супервизор — это **мама** для демонов: запускает, кормит, следит, чтобы не убежали.

---

### **Ключевые отличия**

|Кто|Что делает|
|---|---|
|**Демон**|Работает в фоне, выполняет задачу (веб-сервер, очередь, база)|
|**Супервизор**|Следит, чтобы демон жил, логирует и перезапускает при сбое|

Без супервизора демон — как подросток без будильника: вроде бы жив, но рано или поздно уснёт навсегда.

---

### **В Docker-мире**

В контейнере принято запускать **один процесс** — и он обычно сам демон.  
Но классические демоны (nginx, php-fpm) не должны “уходить в фон”, поэтому запускают их с флагом:

```
php-fpm --nodaemonize
```

чтобы контейнер не посчитал, что он “закончил работу”.

Если нужно несколько сервисов в одном контейнере — добавляют **supervisord**:

```ini
[program:nginx]
command=nginx -g "daemon off;"

[program:php-fpm]
command=php-fpm --nodaemonize
```

---

### **Коротко**

- Демон = программа, работающая фоном, без терминала.
    
- Супервизор = родитель, который следит, чтобы демон не сдох.
    
- В Linux супервизор по умолчанию — systemd.
    
- В Docker часто используют supervisord или process manager внутри.
    



