### –ß—Ç–æ —ç—Ç–æ

**gRPC** ‚Äî —ç—Ç–æ **–≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π RPC-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫** –æ—Ç Google,  
—Ä–∞–±–æ—Ç–∞—é—â–∏–π –ø–æ–≤–µ—Ä—Ö **HTTP/2** –∏ –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π **Protocol Buffers (protobuf)** –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.

–ï—Å–ª–∏ REST ‚Äî —ç—Ç–æ ‚Äú–≤–µ–∂–ª–∏–≤—ã–π –æ–±–º–µ–Ω JSON –ø–æ HTTP/1.1‚Äù,  
—Ç–æ gRPC ‚Äî ‚Äú–±–∏–Ω–∞—Ä–Ω—ã–π, —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏ —Å–∂–∞—Ç—ã–π –æ–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏ –ø–æ HTTP/2 —Å –º—É–ª—å—Ç–∏–ø–ª–µ–∫—Å–æ–º –∏ —Å—Ç—Ä–∏–º–∏–Ω–≥–æ–º‚Äù.

---

### –°—É—Ç—å –≤ –æ–¥–Ω–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏

gRPC = **–≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–æ–≤ –ø–æ —Å–µ—Ç–∏** (–∫–∞–∫ RPC),  
**—Å –±–∏–Ω–∞—Ä–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏** (protobuf)  
–∏ **—Å—Ç—Ä–∏–º–∏–Ω–≥–æ–º** (HTTP/2).

---

### –ö–∞–∫ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç

#### 1. –û–ø–∏—Å–∞–Ω–∏–µ API –≤ `.proto` —Ñ–∞–π–ª–µ

```proto
syntax = "proto3";

service UserService {
  rpc GetUser (UserRequest) returns (UserResponse);
  rpc ListUsers (Empty) returns (UserList);
}

message UserRequest {
  int32 id = 1;
}

message UserResponse {
  int32 id = 1;
  string name = 2;
  string email = 3;
}

message UserList {
  repeated UserResponse users = 1;
}
```

#### 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞

–¢—ã –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—à—å —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `protoc`, –∏ –ø–æ–ª—É—á–∞–µ—à—å –∫–ª–∏–µ–Ω—Ç –∏ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ª—é–±–æ–≥–æ —è–∑—ã–∫–∞:  
PHP, Go, Python, Rust, C++, Java ‚Äî –≤—Å—ë, —á—Ç–æ —à–µ–≤–µ–ª–∏—Ç—Å—è.

```bash
protoc --php_out=./gen --grpc_out=./gen --plugin=protoc-gen-grpc=/usr/bin/grpc_php_plugin user.proto
```

#### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–ö–ª–∏–µ–Ω—Ç –ø—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥, –∫–∞–∫ –ª–æ–∫–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é:

```php
$response = $client->GetUser(new UserRequest(['id' => 42]));
echo $response->getName();
```

–ò –≤—Å—ë.  
–ù–∏–∫–∞–∫–∏—Ö HTTP-–º–µ—Ç–æ–¥–æ–≤, JSON-–ø–∞—Ä—Å–∏–Ω–≥–∞, —Ä—É—á–Ω—ã—Ö —Å—Ö–µ–º.  
–§—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è.

---

### –ü–æ—á–µ–º—É **gRPC –±—ã—Å—Ç—Ä—ã–π**

#### 1. **–ë–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (Protocol Buffers)**

–í–º–µ—Å—Ç–æ JSON-—Å—Ç—Ä–æ–∫ ‚Äî –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ –¥–≤–æ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

- JSON: `{ "id": 42, "name": "Mike" }` ‚âà **33 –±–∞–π—Ç–∞**
    
- Protobuf: —Ç–æ—Ç –∂–µ –æ–±—ä–µ–∫—Ç ‚âà **6‚Äì8 –±–∞–π—Ç**
    

–¢–æ –µ—Å—Ç—å —ç–∫–æ–Ω–æ–º–∏—è **–≤ 4‚Äì6 —Ä–∞–∑ –ø–æ —Ä–∞–∑–º–µ—Ä—É**, –ø–ª—é—Å –Ω–µ –Ω—É–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å —Ç–µ–∫—Å—Ç.

#### 2. **HTTP/2 —Å –º—É–ª—å—Ç–∏–ø–ª–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ–º**

REST –Ω–∞ HTTP/1.1 ‚Äî –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å = –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.  
gRPC –ø–æ HTTP/2 –º–æ–∂–µ—Ç –¥–µ—Ä–∂–∞—Ç—å **–¥–µ—Å—è—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –æ–¥–Ω–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏**.

–†–µ–∑—É–ª—å—Ç–∞—Ç:

- –ú–µ–Ω—å—à–µ TCP-handshake
    
- –ú–µ–Ω—å—à–µ overhead‚Äô–∞ –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∏
    
- –ë—ã—Å—Ç—Ä–µ–µ –æ—Ç–≤–µ—Ç –ø—Ä–∏ –±–æ–ª—å—à–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
    

#### 3. **–¢–∏–ø–∏–∑–∞—Ü–∏—è –∏ –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è**

–ù–µ—Ç —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ `json_encode()` –∏ `json_decode()`.  
–í—Å—ë —Å—Ç—Ä–æ–≥–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –∏ –±–∏–Ω–∞—Ä–Ω–æ, –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –∑–Ω–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞—Ä–∞–Ω–µ–µ.

#### 4. **Streaming**

–ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∏ –ø–æ–ª—É—á–∞—Ç—å –ø–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö (bidirectional stream).  
–≠—Ç–æ –∑–Ω–∞—á–∏—Ç: –Ω–µ –∂–¥—ë—à—å –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–∞–∫–µ—Ç–∞ ‚Äî —Å–µ—Ä–≤–µ—Ä —à–ª—ë—Ç –∫—É—Å–∫–∏ –ø–æ –º–µ—Ä–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏.

---

### –ó–∞–º–µ—Ä—ã (—É—Å—Ä–µ–¥–Ω—ë–Ω–Ω–æ)

|–ü—Ä–æ—Ç–æ–∫–æ–ª|–†–∞–∑–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ (–±–∞–π—Ç)|–í—Ä–µ–º—è roundtrip (–º—Å)|CPU –Ω–∞ –ø–∞—Ä—Å–∏–Ω–≥|
|---|---|---|---|
|REST (JSON)|~700|5.8|100% (—Å—Ç—Ä–æ–∫–æ–≤—ã–π –ø–∞—Ä—Å–∏–Ω–≥)|
|JSON-RPC|~600|5.1|90%|
|gRPC (protobuf)|~120|1.4|20%|

–í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –ø—Ä–∏ 10k RPS —ç–∫–æ–Ω–æ–º–∏—è —Å–æ—Ç–µ–Ω –º–µ–≥–∞–±–∞–π—Ç —Ç—Ä–∞—Ñ–∏–∫–∞ –∏ CPU-—Ü–∏–∫–ª–æ–≤.

---

### –ü—Ä–∏–º–µ—Ä —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –∫–æ–¥–∞ (–Ω–∞ Go, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –∏–¥–µ—é)

```go
func (s *Server) GetUser(ctx context.Context, req *pb.UserRequest) (*pb.UserResponse, error) {
  user := UserResponse{Id: req.Id, Name: "Mikhail Savin", Email: "mikhail.d.savin@gmail.com"}
  return &user, nil
}
```

–ö–ª–∏–µ–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥, –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞ ~1 –º—Å ‚Äî  
–±–µ–∑ JSON-—Å—Ç—Ä–æ–∫, –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ HTTP.

---

### –ü—Ä–∏–º–µ—Ä —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ JSON vs Protobuf

|–§–æ—Ä–º–∞—Ç|–î–∞–Ω–Ω—ã–µ|–†–∞–∑–º–µ—Ä|–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π|
|---|---|---|---|
|JSON|`{"id":42,"name":"Mikhail"}`|28 –±–∞–π—Ç|–ß–∏—Ç–∞–µ–º–æ, –Ω–æ –º–Ω–æ–≥–æ—Å–ª–æ–≤–Ω–æ|
|Protobuf (hex)|`08 2A 12 07 4D 69 6B 68 61 69 6C`|11 –±–∞–π—Ç|–ù–µ—á–∏—Ç–∞–µ–º–æ, –Ω–æ –±—ã—Å—Ç—Ä–æ|

---

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **–¢–∏–ø–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–æ–≥–∞—è** ‚Äî –≤—Å—ë –æ–ø–∏—Å–∞–Ω–æ –≤ `.proto`, –æ—à–∏–±–∫–∏ –ª–æ–≤—è—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏.
    
- **–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç ‚Äî HTTP/2**, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TLS.
    
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å—Ç—Ä–∏–º–∏–Ω–≥ (Server, Client, Bi-directional)**.
    
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç deadline, cancel, metadata, interceptors**.
    
- **–ú–æ–∂–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∏ mock-—Å–µ—Ä–≤–µ—Ä—ã.**
    

---

### –ö–æ–≥–¥–∞ gRPC ‚Äî —ç—Ç–æ üî•

‚úÖ –ú–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ (service-to-service)  
‚úÖ –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ latency  
‚úÖ –ù—É–∂–Ω–∞ —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç  
‚úÖ –ß–∞—Å—Ç—ã–µ –≤—ã–∑–æ–≤—ã –º–µ–ª–∫–∏—Ö –º–µ—Ç–æ–¥–æ–≤ (—ç–∫–æ–Ω–æ–º–∏—è –Ω–∞ overhead)  
‚úÖ –ü–æ—Ç–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (—á–∞—Ç—ã, –ª–æ–≥–∏, —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è)

---

### –ö–æ–≥–¥–∞ gRPC ‚Äî –Ω–µ –Ω—É–∂–µ–Ω

üö´ –ü—É–±–ª–∏—á–Ω–æ–µ API (–±—Ä–∞—É–∑–µ—Ä—ã –ø–ª–æ—Ö–æ —Ä–∞–±–æ—Ç–∞—é—Ç —Å gRPC)  
üö´ –ü—Ä–æ—Å—Ç—ã–µ CRUD-—Å—Ü–µ–Ω–∞—Ä–∏–∏ (REST –±—ã—Å—Ç—Ä–µ–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)  
üö´ –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç ‚Äî –Ω–µ —Ç—ã (–Ω—É–∂–Ω–æ –¥—É–º–∞—Ç—å –æ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ—Å—Ç–æ—Ç–µ)

---

### gRPC –ø—Ä–æ—Ç–∏–≤ REST

|–ü–∞—Ä–∞–º–µ—Ç—Ä|REST|gRPC|
|---|---|---|
|–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö|JSON (—Ç–µ–∫—Å—Ç)|Protobuf (–±–∏–Ω–∞—Ä–Ω—ã–π)|
|–ü—Ä–æ—Ç–æ–∫–æ–ª|HTTP/1.1|HTTP/2|
|–†–∞–∑–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π|–±–æ–ª—å—à–æ–π|–≤ 4‚Äì6 —Ä–∞–∑ –º–µ–Ω—å—à–µ|
|–°–∫–æ—Ä–æ—Å—Ç—å|–º–µ–¥–ª–µ–Ω–Ω–µ–µ|–±—ã—Å—Ç—Ä–µ–µ|
|–¢–∏–ø–∏–∑–∞—Ü–∏—è|–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è|—Å—Ç—Ä–æ–≥–∞—è|
|–°—Ç—Ä–∏–º–∏–Ω–≥|–Ω–µ—Ç|–¥–∞|
|–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ HTTP|–¥–∞|–Ω–µ—Ç|
|–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å|—á–µ–ª–æ–≤–µ–∫ –º–æ–∂–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å|—Ç–æ–ª—å–∫–æ —Ç—É–ª|

---

### –ò—Ç–æ–≥

gRPC ‚Äî —ç—Ç–æ **RPC –Ω–∞ —Å—Ç–µ—Ä–æ–∏–¥–∞—Ö**:  
—Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, –±–∏–Ω–∞—Ä–Ω—ã–π, –ø–æ—Ç–æ–∫–æ–≤—ã–π –∏ –ø–æ—á—Ç–∏ –Ω–µ —Ç—Ä–∞—Ç—è—â–∏–π CPU.

–û–Ω –Ω—É–∂–µ–Ω –Ω–µ ‚Äú—á—Ç–æ–±—ã –º–æ–¥–Ω–æ‚Äù, –∞ —á—Ç–æ–±—ã **–Ω–µ —É–±–∏–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä –º–∏–ª–ª–∏–æ–Ω–∞–º–∏ JSON-–ø–∞—Ä—Å–µ—Ä–æ–≤**.  
REST —Ö–æ—Ä–æ—à, –ø–æ–∫–∞ —É —Ç–µ–±—è 100 RPS.  
gRPC —Ö–æ—Ä–æ—à, –∫–æ–≥–¥–∞ —É —Ç–µ–±—è 10 000 –∏ —Ç—ã —Å—á–∏—Ç–∞–µ—à—å –±–∞–π—Ç—ã, –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã –∏ —Ç–µ–ø–ª–æ –æ—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞.

