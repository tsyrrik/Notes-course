### –ß—Ç–æ —ç—Ç–æ

PHP-FPM ‚Äî –º–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, –∏—Å–ø–æ–ª–Ω—è—é—â–∏–π PHP-–∫–æ–¥ **–≤ –≤–∏–¥–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø—É–ª–∞ –≤–æ—Ä–∫–µ—Ä–æ–≤**, –∞ –Ω–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ, –∫–∞–∫ —ç—Ç–æ –¥–µ–ª–∞–ª —Å—Ç–∞—Ä—ã–π `mod_php` –≤ Apache.  
FPM = **FastCGI Process Manager**: –æ–Ω –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ (–æ–±—ã—á–Ω–æ nginx) –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç –∏—Ö –≤ PHP-–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä, –∑–∞–ø—É—â–µ–Ω–Ω—ã–π –∫–∞–∫ —Ñ–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å.

–ò–¥–µ—è –ø—Ä–æ—Å—Ç–∞—è:  
–≤–µ–±-—Å–µ—Ä–≤–µ—Ä –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è **–æ—Ç–¥–∞—á–µ–π —Ñ–∞–π–ª–æ–≤ –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–æ–π**,  
–∞ PHP-FPM ‚Äî **–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∫–æ–¥–∞**.  
–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ç—Ä—É–¥–∞. –ö–∞–∫ –≤ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.


–ö–æ–≥–¥–∞ **nginx** –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ `.php` —Ñ–∞–π–ª—É, –æ–Ω –ø–µ—Ä–µ–¥–∞—ë—Ç –µ–≥–æ —á–µ—Ä–µ–∑ FastCGI:

```
fastcgi_pass unix:/run/php/php-fpm.sock;
```

–ú–µ–Ω–µ–¥–∂–µ—Ä –≤—ã–±–∏—Ä–∞–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã–π –≤–æ—Ä–∫–µ—Ä (–¥–æ—á–µ—Ä–Ω–∏–π –ø—Ä–æ—Ü–µ—Å—Å PHP) –∏ –æ—Ç–¥–∞—ë—Ç –µ–º—É –∑–∞–¥–∞—á—É.


---

### –ó–∞—á–µ–º –Ω—É–∂–µ–Ω

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π** ‚Äî –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –Ω–µ —Ç—è–Ω–µ—Ç –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å.
    
2. **–ö–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤** ‚Äî –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ –≤–æ—Ä–∫–µ—Ä–æ–≤ –¥–µ—Ä–∂–∞—Ç—å, –∫–æ–≥–¥–∞ –∏—Ö –ø–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ –∫–∞–∫ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å.
    
3. **–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å** ‚Äî –ø–∞–¥–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –≤–æ—Ä–∫–µ—Ä–∞ –Ω–µ —É–±–∏–≤–∞–µ—Ç –≤–µ—Å—å —Å–µ—Ä–≤–µ—Ä.
    
4. **–ì–∏–±–∫–æ—Å—Ç—å** ‚Äî —Ä–∞–∑–Ω—ã–µ –ø—É–ª—ã –≤–æ—Ä–∫–µ—Ä–æ–≤ –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ —Å–∞–π—Ç—ã, –≤–µ—Ä—Å–∏–∏ PHP, –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.
    

---

### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (`/etc/php-fpm.d/www.conf` –∏–ª–∏ `/usr/local/etc/php-fpm.d/www.conf`)

#### ‚öôÔ∏è –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

|–ü–∞—Ä–∞–º–µ—Ç—Ä|–û–ø–∏—Å–∞–Ω–∏–µ|
|---|---|
|`pm`|—Ä–µ–∂–∏–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏: `static`, `dynamic`, `ondemand`|
|`pm.max_children`|–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –≤–æ—Ä–∫–µ—Ä–æ–≤|
|`pm.start_servers`|—Å–∫–æ–ª—å–∫–æ –≤–æ—Ä–∫–µ—Ä–æ–≤ –ø–æ–¥–Ω—è—Ç—å —Å—Ä–∞–∑—É (–¥–ª—è `dynamic`)|
|`pm.min_spare_servers`, `pm.max_spare_servers`|–≥—Ä–∞–Ω–∏—Ü—ã –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–æ—Å—Ç–∞–∏–≤–∞—é—â–∏—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤|
|`pm.process_idle_timeout`|–≤—Ä–µ–º—è –ø—Ä–æ—Å—Ç–æ—è –¥–æ —É–±–∏–π—Å—Ç–≤–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ (`ondemand`)|

#### üíæ –ü–∞–º—è—Ç—å –∏ –ª–æ–≥–∏

|–ü–∞—Ä–∞–º–µ—Ç—Ä|–û–ø–∏—Å–∞–Ω–∏–µ|
|---|---|
|`memory_limit`|–ª–∏–º–∏—Ç –ø–∞–º—è—Ç–∏ –Ω–∞ –æ–¥–∏–Ω –≤–æ—Ä–∫–µ—Ä|
|`php_admin_value[error_log]`|–ø—É—Ç—å –∫ –ª–æ–≥–∞–º PHP|
|`request_terminate_timeout`|—É–±–∏–≤–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç, –µ—Å–ª–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ–ª—å—à–µ|
|`request_slowlog_timeout`|–≤—Ä–µ–º—è, –ø–æ—Å–ª–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –º–µ–¥–ª–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –ø–∏—à–µ—Ç—Å—è –≤ slowlog|
|`slowlog`|–ø—É—Ç—å –∫ slowlog-—Ñ–∞–π–ª—É (—á–∞—Å—Ç–æ `/var/log/php-fpm/slow.log`)|

#### üß© –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

|–ü–∞—Ä–∞–º–µ—Ç—Ä|–û–ø–∏—Å–∞–Ω–∏–µ|
|---|---|
|`catch_workers_output = yes`|–ø–∏—Å–∞—Ç—å stdout/stderr PHP –≤ –ª–æ–≥|
|`access.log`|–º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –ª–æ–≥ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ FPM|
|`ping.path = /ping`|healthcheck –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞|
|`pm.status_path = /status`|endpoint –¥–ª—è –º–µ—Ç—Ä–∏–∫ (—á–∏—Å–ª–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, –∑–∞–≥—Ä—É–∑–∫–∞ –∏ —Ç.–ø.)|

---

### –ü–æ—á–µ–º—É —Å–≤—è–∑–∫–∞ nginx + php-fpm –≤—ã–∏–≥—Ä—ã–≤–∞–µ—Ç Apache

|nginx + php-fpm|Apache (mod_php)|
|---|---|
|–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å, –¥–µ—Ä–∂–∏—Ç –¥–µ—Å—è—Ç–∫–∏ —Ç—ã—Å—è—á —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π|–ü—Ä–æ—Ü–µ—Å—Å –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å|
|PHP –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ, –Ω–µ –∂—Ä—ë—Ç –ø–∞–º—è—Ç—å –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞|PHP –≤—Å—Ç—Ä–æ–µ–Ω, –∫–∞–∂–¥—ã–π –≤–æ—Ä–∫–µ—Ä Apache —Ç—è–Ω–µ—Ç –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä|
|–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ PHP –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ|–û–¥–Ω–∞ –≤–µ—Ä—Å–∏—è –Ω–∞ –≤–µ—Å—å —Å–µ—Ä–≤–µ—Ä|
|–ì–∏–±–∫–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è FastCGI|–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ .htaccess|
|–õ–µ–≥—á–µ –¥–µ–ø–ª–æ–∏—Ç—å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö|Apache –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—è–º–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏|

---

### üî• –ü–æ–ª–µ–∑–Ω—ã–µ —Ñ–∏—á–∏ –∏ –ø—Ä–∞–∫—Ç–∏–∫–∏

- **Slowlog** ‚Äî –∞–∫—Ç–∏–≤–∏—Ä—É–π `request_slowlog_timeout` –∏ `slowlog`, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å, –≥–¥–µ —Ä–µ–∞–ª—å–Ω–æ —Ç–æ—Ä–º–æ–∑–∏—Ç –∫–æ–¥.
    
- **status-endpoint**: `/status?full` –ø–æ–∫–∞–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤ –∏ —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏.
    
- **graceful reload**: `kill -USR2 $(cat /run/php-fpm.pid)` –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –±–µ–∑ –æ–±—Ä—ã–≤–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.
    
- **—Ä–∞–∑–¥–µ–ª—è–π –ø—É–ª—ã** ‚Äî –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –ø—É–ª—ã `www.conf`, `admin.conf`, `queue.conf` —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –ª–∏–º–∏—Ç–∞–º–∏.
    
- **opcache** ‚Äî –ø–æ—á—Ç–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —Å–ø—É—Ç–Ω–∏–∫ FPM: –∫–µ—à–∏—Ä—É–µ—Ç —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ PHP-—Ñ–∞–π–ª—ã, —É—Å–∫–æ—Ä—è—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.
    

---

### –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥–∞ –ø—É–ª–∞

```ini
[www]
user = www-data
group = www-data
listen = /run/php/php-fpm.sock
listen.owner = www-data
listen.group = www-data

pm = dynamic
pm.max_children = 10
pm.start_servers = 3
pm.min_spare_servers = 2
pm.max_spare_servers = 5

request_terminate_timeout = 30s
request_slowlog_timeout = 3s
slowlog = /var/log/php-fpm/slow.log
```

---

### –í —Å–≤—è–∑–∫–µ —Å nginx

```nginx
location ~ \.php$ {
    include fastcgi_params;
    fastcgi_pass unix:/run/php/php-fpm.sock;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
}
```

**nginx —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 80/443, PHP-FPM ‚Äî unix-—Å–æ–∫–µ—Ç –∏–ª–∏ TCP-–ø–æ—Ä—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä 9000).**

---

### üß† –ò—Ç–æ–≥–æ

PHP-FPM ‚Äî —ç—Ç–æ –Ω–µ ¬´—Ñ–æ–Ω–æ–≤—ã–π –¥–µ–º–æ–Ω –¥–ª—è PHP¬ª, –∞ –ø—Ä–æ–¥—É–º–∞–Ω–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, –¥–∞—é—â–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Ç–µ–º, **–∫–∞–∫ –∏ —Å–∫–æ–ª—å–∫–æ PHP-–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–æ–≤** –∂–∏–≤—É—Ç –≤ —Å–∏—Å—Ç–µ–º–µ.  
–ë–µ–∑ –Ω–µ–≥–æ nginx –Ω–µ —Å–º–æ–≥ –±—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å PHP-–∫–æ–¥ ‚Äî –∞ Apache –±–µ–∑ –Ω–µ–≥–æ –ø—Ä–æ—Å—Ç–æ —Ç—Ä–∞—Ç–∏—Ç —Ä–µ—Å—É—Ä—Å—ã –≤–ø—É—Å—Ç—É—é.

[[—á–∏—Å–ª–æ –≤–æ—Ä–∫–µ—Ä–æ–≤]]