**Prometheus** ‚Äî —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞ **–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫** (time-series database),  
—Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –≤ SoundCloud –∏ –Ω—ã–Ω–µ —á–∞—Å—Ç—å CNCF (Cloud Native Computing Foundation).  
–û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è: —Å–µ—Ä–≤–∏—Å—ã —Å–∞–º–∏ –æ—Ç–¥–∞—é—Ç —Å–≤–æ–∏ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ HTTP,  
–∞ Prometheus –∏—Ö **–ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç (pull)** –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏.

---

### 1. –ì–ª–∞–≤–Ω–∞—è –∏–¥–µ—è

Prometheus –Ω–µ –∂–¥—ë—Ç, –∫–æ–≥–¥–∞ –µ–º—É ‚Äú–ø—Ä–∏–Ω–µ—Å—É—Ç‚Äù –¥–∞–Ω–Ω—ã–µ.  
–û–Ω **—Ö–æ–¥–∏—Ç —Å–∞–º** –ø–æ endpoint‚Äô–∞–º (–æ–±—ã—á–Ω–æ `/metrics`) –∏ —Å–æ–±–∏—Ä–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è.

–ü—Ä–∏–º–µ—Ä –º–µ—Ç—Ä–∏–∫–∏:

```
php_fpm_active_processes{pool="www"} 5
```

> –ö–∞–∂–¥–∞—è –º–µ—Ç—Ä–∏–∫–∞ ‚Äî —ç—Ç–æ –ø–∞—Ä–∞ (–∏–º—è + –Ω–∞–±–æ—Ä –º–µ—Ç–æ–∫ + –∑–Ω–∞—á–µ–Ω–∏–µ + timestamp).

---

### 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Prometheus:**

- üß† **Prometheus server** ‚Äî –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ç–∞—Ä–≥–µ—Ç—ã –∏ —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ.
    
- üè∑Ô∏è **Service discovery** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç —Å–µ—Ä–≤–∏—Å—ã (Kubernetes, EC2, Consul).
    
- üìà **TSDB (Time Series DB)** ‚Äî –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫.
    
- üì§ **Alertmanager** ‚Äî –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∞–ª–µ—Ä—Ç—ã.
    
- üîå **Exporters** ‚Äî –∞–≥–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–¥–∞—é—Ç –º–µ—Ç—Ä–∏–∫–∏ (node_exporter, postgres_exporter –∏ —Ç.–¥.).
    
- üìä **Grafana** ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è (—á–∞—â–µ –≤—Å–µ–≥–æ –ø–æ–≤–µ—Ä—Ö Prometheus).
    

---

### 3. –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –°–µ—Ä–≤–∏—Å –æ—Ç–¥–∞—ë—Ç –º–µ—Ç—Ä–∏–∫–∏ –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –ø–æ `/metrics`.
    
2. Prometheus —Ä–µ–≥—É–ª—è—Ä–Ω–æ –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç —ç—Ç–æ—Ç endpoint (–ø–æ cron-–∏–Ω—Ç–µ—Ä–≤–∞–ª—É).
    
3. –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ TSDB.
    
4. –ú–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ PromQL, —Å—Ç—Ä–æ–∏—Ç—å –¥–∞—à–±–æ—Ä–¥—ã –∏–ª–∏ –ø—Ä–∞–≤–∏–ª–∞ –∞–ª–µ—Ä—Ç–æ–≤.
    

---

### 4. –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (`prometheus.yml`)

```yaml
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'php-fpm'
    static_configs:
      - targets: ['app1:9000', 'app2:9000']

  - job_name: 'node'
    static_configs:
      - targets: ['node-exporter:9100']
```

Prometheus —Å–∞–º –±—É–¥–µ—Ç –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥ –∑–∞–±–∏—Ä–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ —Å —ç—Ç–∏—Ö —Ç–∞—Ä–≥–µ—Ç–æ–≤.

---

### 5. –ü—Ä–∏–º–µ—Ä –º–µ—Ç—Ä–∏–∫ PHP / –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

|–≠–∫—Å–ø–æ—Ä—Ç–µ—Ä|–ú–µ—Ç—Ä–∏–∫–∏|
|---|---|
|**node_exporter**|CPU, RAM, –¥–∏—Å–∫–∏, —Å–µ—Ç–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã|
|**php-fpm_exporter**|–≤–æ—Ä–∫–µ—Ä—ã, –æ—á–µ—Ä–µ–¥—å, –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã|
|**nginx_exporter**|–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, latency|
|**redis_exporter**|hit/miss, connected clients, memory|
|**postgres_exporter**|–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–æ–Ω–Ω–µ–∫—Ç—ã, replication lag, deadlocks|
|**blackbox_exporter**|–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å HTTP, TCP, DNS, ICMP|

---

### 6. PromQL ‚Äî —è–∑—ã–∫ –∑–∞–ø—Ä–æ—Å–æ–≤

Prometheus –∏–º–µ–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫ ‚Äî **PromQL (Prometheus Query Language)**.  
–û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å, –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å –∏ —Å—Ç—Ä–æ–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –≤–æ –≤—Ä–µ–º–µ–Ω–∏.

–ü—Ä–∏–º–µ—Ä—ã:

```promql
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É
rate(http_requests_total[1m])

# –°—Ä–µ–¥–Ω—è—è –∑–∞–≥—Ä—É–∑–∫–∞ CPU –∑–∞ 5 –º–∏–Ω—É—Ç
avg(rate(node_cpu_seconds_total[5m])) by (mode)

# –ö–æ–ª-–≤–æ PHP-FPM –≤–æ—Ä–∫–µ—Ä–æ–≤ –ø–æ –ø—É–ª–∞–º
php_fpm_active_processes{pool=~".+"}

# –û—à–∏–±–∫–∏ 5xx –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –º–∏–Ω—É—Ç
increase(http_requests_total{status=~"5.."}[10m])
```

---

### 7. Alerts

Prometheus —É–º–µ–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç—å **–∞–ª–µ—Ä—Ç—ã** –Ω–∞ –æ—Å–Ω–æ–≤–µ PromQL.

`alert.rules.yml`:

```yaml
groups:
  - name: php
    rules:
      - alert: HighLoad
        expr: rate(http_requests_total[5m]) > 100
        for: 1m
        labels:
          severity: warning
        annotations:
          description: "–í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ PHP –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç"
```

–ê–ª–µ—Ä—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ **Alertmanager**,  
–∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç —Å–ª–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ **Slack, Telegram, PagerDuty** –∏ —Ç.–ø.

---

### 8. –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

Prometheus —Ö—Ä–∞–Ω–∏—Ç –º–µ—Ç—Ä–∏–∫–∏ –ª–æ–∫–∞–ª—å–Ω–æ –≤ –≤–∏–¥–µ time-series (–±–ª–æ–∫–∏ –ø–æ 2 —á–∞—Å–∞).  
–î–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **remote_write**:

- **Thanos**
    
- **Cortex**
    
- **VictoriaMetrics**
    
- **Mimir**
    

> –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –º–µ—Å—è—Ü—ã –∏–ª–∏ –≥–æ–¥—ã –º–µ—Ç—Ä–∏–∫ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É.

---

### 9. –ü–æ—á–µ–º—É Prometheus —Å—Ç–∞–ª —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º

|–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å|–ß—Ç–æ –¥–∞—ë—Ç|
|---|---|
|**Pull-–º–æ–¥–µ–ª—å**|–£–ø—Ä–æ—â–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –¥–µ–ø–ª–æ–π (–º–µ—Ç—Ä–∏–∫–∏ —Å–∞–º–∏ –¥–æ—Å—Ç—É–ø–Ω—ã)|
|**–°–µ–º–∞–Ω—Ç–∏–∫–∞ —Ç–µ–≥–æ–≤**|–õ–µ–≥–∫–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å, –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å|
|**PromQL**|–°–∏–ª—å–Ω—ã–π —è–∑—ã–∫ –¥–ª—è –∞–ª–µ—Ä—Ç–æ–≤ –∏ –≥—Ä–∞—Ñ–∏–∫–æ–≤|
|**–°–µ—Ä–≤–∏—Å-–¥–∏—Å–∫–∞–≤–µ—Ä–∏**|–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Kubernetes, Consul|
|**OpenMetrics-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**|–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç PHP, Go, Python –∏ –¥—Ä.)|

---

### 10. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –ø—Ä–∞–∫—Ç–∏–∫–∏

- PHP: `promphp/prometheus_client_php`
    
- Symfony: `artprima/prometheus-metrics-bundle`
    
- Laravel: `renoki-co/laravel-exporter`
    
- Docker / K8s: `cAdvisor`, `kube-state-metrics`
    
- Grafana: –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å —à–∞–±–ª–æ–Ω–∞–º–∏ PromQL
    

---

### üí° –í –æ–¥–Ω–æ–π —Ñ—Ä–∞–∑–µ

> **Prometheus** ‚Äî —ç—Ç–æ –º–æ–∑–≥ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:  
> –æ–Ω –≤—Å—ë –≤—Ä–µ–º—è —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç ‚Äú–∫–∞–∫ —Ç—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—à—å?‚Äù  
> –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç—ã –≤ –±–∞–∑—É –≤—Ä–µ–º–µ–Ω–∏.  
> Grafana ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –∫—Ä–∞—Å–∏–≤–∞—è –º–æ—Ä–¥–∞ –∫ —ç—Ç–∏–º –≤–æ–ø—Ä–æ—Å–∞–º.

[[Grafana]]
