**RabbitMQ** ‚Äî —ç—Ç–æ –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π **AMQP (Advanced Message Queuing Protocol)**.  
–û–Ω —É–ø—Ä–∞–≤–ª—è–µ—Ç –æ—á–µ—Ä–µ–¥—è–º–∏, –¥–æ—Å—Ç–∞–≤–∫–æ–π, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è–º–∏, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏ –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏ ‚Äî —Ç–æ, —á—Ç–æ Redis –∏–ª–∏ Postgres –¥–µ–ª–∞—é—Ç ‚Äú—á–µ—Ä–µ–∑ –±–æ–ª—å‚Äù.

---

### 1. –ó–∞—á–µ–º –≤–æ–æ–±—â–µ –±—Ä–æ–∫–µ—Ä –æ—á–µ—Ä–µ–¥–µ–π

–û—á–µ—Ä–µ–¥—å ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± **—Ä–∞–∑–≤—è–∑–∞—Ç—å** —á–∞—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã:  
–æ–¥–∏–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á—É, –¥—Ä—É–≥–æ–π –∑–∞–±–∏—Ä–∞–µ—Ç –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç.

RabbitMQ –¥–æ–±–∞–≤–ª—è–µ—Ç –∫ —ç—Ç–æ–º—É:

- –≥–∞—Ä–∞–Ω—Ç–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
    
- –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –º–µ–∂–¥—É –≤–æ—Ä–∫–µ—Ä–∞–º–∏,
    
- –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è,
    
- —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ –¥–∏—Å–∫ (durability).
    

---

### 2. –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–æ–ª–∏

|–ö–æ–º–ø–æ–Ω–µ–Ω—Ç|–û–ø–∏—Å–∞–Ω–∏–µ|
|---|---|
|**Producer**|–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏–π|
|**Queue**|–ë—É—Ñ–µ—Ä —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π|
|**Consumer**|–ü–æ–ª—É—á–∞—Ç–µ–ª—å (–≤–æ—Ä–∫–µ—Ä)|
|**Exchange**|–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä, —Ä–µ—à–∞–µ—Ç –≤ –∫–∞–∫—É—é –æ—á–µ—Ä–µ–¥—å –ø–æ–ª–æ–∂–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ|
|**Binding key**|–ü—Ä–∞–≤–∏–ª–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ (pattern)|

---

### 3. Push / Pull

RabbitMQ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ **push-–º–æ–¥–µ–ª–∏**:  
—Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –∫–æ–Ω—Å—å—é–º–µ—Ä–∞–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –æ–Ω–∏ —Å–≤–æ–±–æ–¥–Ω—ã.

> –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç pull-–º–æ–¥–µ–ª–∏ (–∫–∞–∫ –≤ Kafka), –≥–¥–µ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å —Å–∞–º ‚Äú—Ç—è–Ω–µ—Ç‚Äù –¥–∞–Ω–Ω—ã–µ.

–ü–ª—é—Å—ã push:

- –Ω–∏–∑–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞;
    
- —É–¥–æ–±–Ω–æ –¥–ª—è —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á.
    

–ú–∏–Ω—É—Å—ã:

- –µ—Å–ª–∏ –∫–æ–Ω—Å—å—é–º–µ—Ä –º–µ–¥–ª–µ–Ω–Ω—ã–π, –µ–≥–æ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–≥—Ä—É–∑–∏—Ç—å ‚Üí —Ä–µ—à–∞–µ—Ç—Å—è `prefetch_count`.
    

```php
$channel->basic_qos(null, 5, null); // –Ω–µ —à–ª–∏ –±–æ–ª—å—à–µ 5 —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ –≤–æ—Ä–∫–µ—Ä –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
```

---

### 4. Durability –∏ Persistence

RabbitMQ –º–æ–∂–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ø–∞–º—è—Ç–∏ –∏–ª–∏ –Ω–∞ –¥–∏—Å–∫–µ.

|–ù–∞—Å—Ç—Ä–æ–π–∫–∞|–ß—Ç–æ –¥–µ–ª–∞–µ—Ç|
|---|---|
|**Durable queue**|–û—á–µ—Ä–µ–¥—å –Ω–µ –∏—Å—á–µ–∑–∞–µ—Ç –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –±—Ä–æ–∫–µ—Ä–∞|
|**Persistent messages**|–°–æ–æ–±—â–µ–Ω–∏—è –ø–∏—à—É—Ç—Å—è –Ω–∞ –¥–∏—Å–∫|
|**Publisher confirms**|–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç ACK, –∫–æ–≥–¥–∞ –±—Ä–æ–∫–µ—Ä –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –∑–∞–ø–∏—Å–∞–ª —Å–æ–æ–±—â–µ–Ω–∏–µ|

```php
$channel->queue_declare('jobs', durable: true);
$channel->basic_publish($msg, '', 'jobs', AMQPMessage::DELIVERY_MODE_PERSISTENT);
```

---

### 5. –ì–∞—Ä–∞–Ω—Ç–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏

|–ì–∞—Ä–∞–Ω—Ç–∏—è|–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç|–ö–∞–∫ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è|
|---|---|---|
|**At most once**|—Å–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–µ—Ç –ø–æ—Ç–µ—Ä—è—Ç—å—Å—è, –Ω–æ –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è|–±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (fire & forget)|
|**At least once**|—Å–æ–æ–±—â–µ–Ω–∏–µ —Ç–æ—á–Ω–æ –¥–æ–π–¥—ë—Ç, –Ω–æ –º–æ–∂–µ—Ç –ø—Ä–∏–π—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ|ack/nack + –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞|
|**Exactly once**|—Å–æ–æ–±—â–µ–Ω–∏–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑|–¥–æ—Ä–æ–≥–æ, —Ç—Ä–µ–±—É–µ—Ç –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –∏ deduplication|

–í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –≤—Å–µ –±—Ä–æ–∫–µ—Ä—ã, –≤–∫–ª—é—á–∞—è RabbitMQ, —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ **at-least-once**.  
‚ÄúExactly once‚Äù –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ **–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**,  
–Ω–∞–ø—Ä–∏–º–µ—Ä: –ø—Ä–æ–≤–µ—Ä–∫–∞ `message_id` –∏ –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü—É ‚Äú—É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ‚Äù.

---

### 6. Dead Letter Queue (DLQ)

–ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, consumer –ø–∞–¥–∞–µ—Ç –∏–ª–∏ —à–ª—ë—Ç `nack`),  
–µ–≥–æ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –≤ **–æ—á–µ—Ä–µ–¥—å –º—ë—Ä—Ç–≤—ã—Ö –ø–∏—Å–µ–º** –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π —Ä—É—á–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.

```bash
x-dead-letter-exchange=dlx
x-dead-letter-routing-key=failed
```

> –≠—Ç–æ —Å–ø–∞—Å–∞–µ—Ç –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ ‚Äú–ø–µ—Ä–µ–∫–∏–¥—ã–≤–∞–Ω–∏—è‚Äù —Å–æ–æ–±—â–µ–Ω–∏–π —Ç—É–¥–∞-—Å—é–¥–∞.

---

### 7. –¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

‚úÖ **–§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ (jobs)** ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–∏—Å–µ–º, –ø—É—à–µ–π, webhook-–≤–æ—Ä–∫–µ—Ä—ã.  
‚úÖ **Event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** ‚Äî –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ –Ω–∞ —Å–æ–±—ã—Ç–∏—è (fanout exchange).  
‚úÖ **–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏** –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –≤–æ—Ä–∫–µ—Ä–∞–º–∏.  
‚úÖ **–ü–∞–π–ø–ª–∞–π–Ω—ã** (—Ü–µ–ø–æ—á–∫–∏ –∑–∞–¥–∞—á).  
‚úÖ **–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –º–µ–∂–¥—É –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏**.

---

### 8. –¢–∏–ø—ã Exchanges

|–¢–∏–ø|–ü–æ–≤–µ–¥–µ–Ω–∏–µ|
|---|---|
|**Direct**|–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ —Ç–æ—á–Ω–æ–º—É `routing_key`|
|**Fanout**|—Ä–∞—Å—Å—ã–ª–∞–µ—Ç –≤—Å–µ–º –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º –æ—á–µ—Ä–µ–¥—è–º|
|**Topic**|—à–∞–±–ª–æ–Ω—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä `email.*` –∏–ª–∏ `*.created`|
|**Headers**|–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º —Å–æ–æ–±—â–µ–Ω–∏–π|

---

### 9. –ü–∞—Ä–∞ —Å–æ–≤–µ—Ç–æ–≤ –ø–æ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

- –í—Å–µ–≥–¥–∞ **–≤–∫–ª—é—á–∞–π ACK** (`auto_ack=false`).
    
- –ù–∞—Å—Ç—Ä–æ–π **prefetch_count** ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –≤–æ—Ä–∫–µ—Ä–æ–≤.
    
- –î–µ–ª–∞–π **–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É** —Å–æ–æ–±—â–µ–Ω–∏–π.
    
- –ò—Å–ø–æ–ª—å–∑—É–π **dead-letter queues** –¥–ª—è –æ—à–∏–±–æ–∫.
    
- –ù–µ —Ö—Ä–∞–Ω–∏ –≥–∏–≥–∞–±–∞–π—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –æ—á–µ—Ä–µ–¥—è—Ö ‚Äî —ç—Ç–æ –Ω–µ storage.
    
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: **Prometheus + rabbitmq_exporter**, –ø–∞–Ω–µ–ª—å –≤ Grafana.
    

---

### üí° –í –æ–¥–Ω–æ–π —Ñ—Ä–∞–∑–µ

> **RabbitMQ** ‚Äî —ç—Ç–æ –±—Ä–æ–∫–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π —É–º–µ–µ—Ç –Ω–∞–¥—ë–∂–Ω–æ "–¥–æ–Ω–µ—Å—Ç–∏" —Å–æ–æ–±—â–µ–Ω–∏–µ,
> –¥–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–æ–¥—é—Å–µ—Ä, –≤–æ—Ä–∫–µ—Ä –∏ —Å–µ—Ä–≤–µ—Ä —É–º–µ—Ä–ª–∏ –ø–æ –¥–æ—Ä–æ–≥–µ.
> Redis –∏ Postgres –º–æ–≥—É—Ç –±—ã—Ç—å –æ—á–µ—Ä–µ–¥—è–º–∏, –Ω–æ RabbitMQ ‚Äî –∏–º –∂–∏–≤—ë—Ç.