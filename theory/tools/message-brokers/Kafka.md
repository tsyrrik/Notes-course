**Apache Kafka** ‚Äî —ç—Ç–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –∂—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π (distributed event streaming platform).
–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç RabbitMQ, —ç—Ç–æ –Ω–µ –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π, –∞ **–ª–æ–≥-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞**.

---

### 1. –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è

Kafka —Ö—Ä–∞–Ω–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–∫ **—É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–π –∂—É—Ä–Ω–∞–ª (log)**.
–ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –¥–∏—Å–∫ –∏ —Ö—Ä–∞–Ω–∏—Ç—Å—è –∑–∞–¥–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, 7 –¥–Ω–µ–π).

–ö–ª—é—á–µ–≤—ã–µ –æ—Ç–ª–∏—á–∏—è –æ—Ç –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏—Ö –æ—á–µ—Ä–µ–¥–µ–π:
- —Å–æ–æ–±—â–µ–Ω–∏—è **–Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è** –ø–æ—Å–ª–µ –ø—Ä–æ—á—Ç–µ–Ω–∏—è,
- –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ —Å–∞–º–∏ **—É–ø—Ä–∞–≤–ª—è—é—Ç —Å–≤–æ–µ–π –ø–æ–∑–∏—Ü–∏–µ–π** (offset),
- –º–æ–∂–Ω–æ "–ø–µ—Ä–µ–º–æ—Ç–∞—Ç—å" –Ω–∞–∑–∞–¥ –∏ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∑–∞–Ω–æ–≤–æ.

---

### 2. –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–æ–ª–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|
| **Producer** | –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ —Ç–æ–ø–∏–∫ |
| **Topic** | –õ–æ–≥–∏—á–µ—Å–∫–∏–π –∫–∞–Ω–∞–ª (–∫–∞–∫ –ø–∞–ø–∫–∞ —Å –ª–æ–≥–∞–º–∏) |
| **Partition** | –§–∏–∑–∏—á–µ—Å–∫–∏–π –ª–æ–≥ –≤–Ω—É—Ç—Ä–∏ —Ç–æ–ø–∏–∫–∞ (–¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞) |
| **Consumer** | –ß–∏—Ç–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏–∑ —Ç–æ–ø–∏–∫–∞ |
| **Consumer Group** | –ì—Ä—É–ø–ø–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π ‚Äî –∫–∞–∂–¥–∞—è –ø–∞—Ä—Ç–∏—Ü–∏—è —á–∏—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∏–º –∏–∑ –≥—Ä—É–ø–ø—ã |
| **Broker** | –£–∑–µ–ª –∫–ª–∞—Å—Ç–µ—Ä–∞ Kafka |
| **ZooKeeper / KRaft** | –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞ (–Ω–æ–≤–µ–µ ‚Äî KRaft –±–µ–∑ ZooKeeper) |

---

### 3. Pull-–º–æ–¥–µ–ª—å

Kafka —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ **pull-–º–æ–¥–µ–ª–∏**:
–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å **—Å–∞–º –∑–∞–±–∏—Ä–∞–µ—Ç** —Å–æ–æ–±—â–µ–Ω–∏—è, –∫–æ–≥–¥–∞ –≥–æ—Ç–æ–≤.

–ü–ª—é—Å—ã:
- –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —Ç–µ–º–ø,
- –Ω–µ—Ç —Ä–∏—Å–∫–∞ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ consumer'–∞,
- –º–æ–∂–Ω–æ —á–∏—Ç–∞—Ç—å batch'–∞–º–∏.

–ú–∏–Ω—É—Å—ã:
- –Ω–µ–º–Ω–æ–≥–æ –≤—ã—à–µ latency (–Ω—É–∂–Ω–æ poll'–∏—Ç—å).

---

### 4. Partitions –∏ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º

–¢–æ–ø–∏–∫ —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ **–ø–∞—Ä—Ç–∏—Ü–∏–∏** (partitions).
–ö–∞–∂–¥–∞—è –ø–∞—Ä—Ç–∏—Ü–∏—è ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–π –ª–æ–≥.

```
Topic: orders
  ‚îú‚îÄ Partition 0: [msg1, msg2, msg3]
  ‚îú‚îÄ Partition 1: [msg4, msg5]
  ‚îî‚îÄ Partition 2: [msg6, msg7, msg8]
```

- –°–æ–æ–±—â–µ–Ω–∏—è —Å –æ–¥–Ω–∏–º **–∫–ª—é—á–æ–º** –ø–æ–ø–∞–¥–∞—é—Ç –≤ –æ–¥–Ω—É –ø–∞—Ä—Ç–∏—Ü–∏—é ‚Üí **–≥–∞—Ä–∞–Ω—Ç–∏—è –ø–æ—Ä—è–¥–∫–∞** –¥–ª—è –∫–ª—é—á–∞.
- –†–∞–∑–Ω—ã–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏ —á–∏—Ç–∞—é—Ç—Å—è **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ** —Ä–∞–∑–Ω—ã–º–∏ consumer'–∞–º–∏.

---

### 5. Consumer Groups

Consumer group –ø–æ–∑–≤–æ–ª—è–µ—Ç **–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É**:
- –∫–∞–∂–¥–∞—è –ø–∞—Ä—Ç–∏—Ü–∏—è —á–∏—Ç–∞–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –æ–¥–Ω–∏–º** consumer'–æ–º –∏–∑ –≥—Ä—É–ø–ø—ã,
- –µ—Å–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å consumer'–∞ ‚Äî –ø–∞—Ä—Ç–∏—Ü–∏–∏ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è (rebalance).

```
Consumer Group "order-processors"
  ‚îú‚îÄ Consumer 1 ‚Üí reads Partition 0, 1
  ‚îî‚îÄ Consumer 2 ‚Üí reads Partition 2
```

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ ‚Äî —Å–æ–∑–¥–∞–π —Ä–∞–∑–Ω—ã–µ consumer group'—ã.

---

### 6. Offset –∏ Commit

**Offset** ‚Äî –ø–æ–∑–∏—Ü–∏—è –≤ –ø–∞—Ä—Ç–∏—Ü–∏–∏ (–Ω–æ–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è).

Consumer —Å–∞–º **commit'–∏—Ç offset**, –∫–æ–≥–¥–∞ –æ–±—Ä–∞–±–æ—Ç–∞–ª —Å–æ–æ–±—â–µ–Ω–∏–µ.
–ï—Å–ª–∏ consumer —É–ø–∞–¥—ë—Ç ‚Äî –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ commit'–∞.

```java
consumer.commitSync(); // —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å offset
```

–í–∞—Ä–∏–∞–Ω—Ç—ã:
- **auto-commit** ‚Äî Kafka —Å–∞–º commit'–∏—Ç —Ä–∞–∑ –≤ N —Å–µ–∫—É–Ω–¥ (–º–æ–∂–µ—Ç –ø–æ—Ç–µ—Ä—è—Ç—å –∏–ª–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å),
- **manual commit** ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ (–Ω–∞–¥—ë–∂–Ω–µ–µ).

---

### 7. Retention

Kafka **–Ω–µ —É–¥–∞–ª—è–µ—Ç** —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ—Å–ª–µ –ø—Ä–æ—á—Ç–µ–Ω–∏—è.
–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ:
- **time-based retention** ‚Äî —Ö—Ä–∞–Ω–∏—Ç—å 7 –¥–Ω–µ–π,
- **size-based retention** ‚Äî —Ö—Ä–∞–Ω–∏—Ç—å –¥–æ 100 GB.

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –ø–µ—Ä–µ—á–∏—Ç—ã–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é,
- –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ consumer'–∞, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ —Å–æ–±—ã—Ç–∏—è —Å –Ω–∞—á–∞–ª–∞,
- –æ—Ç–ª–∞–¥–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞.

---

### 8. –ì–∞—Ä–∞–Ω—Ç–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏

| –ì–∞—Ä–∞–Ω—Ç–∏—è | –ö–∞–∫ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è |
|---|---|
| **At most once** | `acks=0` ‚Äî producer –Ω–µ –∂–¥—ë—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è |
| **At least once** | `acks=1` –∏–ª–∏ `acks=all` + —Ä—É—á–Ω–æ–π commit offset |
| **Exactly once** | `enable.idempotence=true` + —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ Kafka |

–ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ:
- **at-least-once** ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç,
- **exactly-once** ‚Äî —Ç—Ä–µ–±—É–µ—Ç –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

---

### 9. Replication

–ö–∞–∂–¥–∞—è –ø–∞—Ä—Ç–∏—Ü–∏—è **—Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç—Å—è** –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –±—Ä–æ–∫–µ—Ä–æ–≤.

```
Partition 0
  ‚îú‚îÄ Leader: Broker 1 (–ø–∏—à–µ—Ç –∏ —á–∏—Ç–∞–µ—Ç)
  ‚îú‚îÄ Follower: Broker 2
  ‚îî‚îÄ Follower: Broker 3
```

- Leader –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã,
- Followers —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∫–æ–ø–∏—Ä—É—é—Ç –¥–∞–Ω–Ω—ã–µ,
- –ï—Å–ª–∏ leader —É–ø–∞–¥—ë—Ç ‚Äî –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –∏–∑ followers.

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ `replication.factor=3` ‚Üí —Ç—Ä–∏ –∫–æ–ø–∏–∏.

---

### 10. –¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

‚úÖ **Event Sourcing** ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã.
‚úÖ **Stream Processing** ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö (Kafka Streams, Flink).
‚úÖ **Log Aggregation** ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–±–æ—Ä –ª–æ–≥–æ–≤.
‚úÖ **CDC (Change Data Capture)** ‚Äî –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ë–î.
‚úÖ **Real-time analytics** ‚Äî –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
‚úÖ **–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤** (–ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏).

---

### 11. Kafka Connect –∏ Kafka Streams

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|---|
| **Kafka Connect** | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ (–ë–î, S3, Elasticsearch) –±–µ–∑ –∫–æ–¥–∞ |
| **Kafka Streams** | –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ—Ç–æ–∫–æ–≤ (Java/Scala) |

–ü—Ä–∏–º–µ—Ä: Kafka Connect ‚Üí CDC –∏–∑ PostgreSQL ‚Üí Kafka ‚Üí Kafka Streams ‚Üí –æ–±—Ä–∞–±–æ—Ç–∫–∞ ‚Üí –≤—ã–≤–æ–¥ –≤ Elasticsearch.

---

### 12. –°–æ–≤–µ—Ç—ã –ø–æ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

- –ù–∞—Å—Ç—Ä–æ–π **replication.factor** –º–∏–Ω–∏–º—É–º 3.
- –ò—Å–ø–æ–ª—å–∑—É–π **acks=all** –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
- –í–∫–ª—é—á–∏ **compression** (snappy, lz4) –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞.
- –ú–æ–Ω–∏—Ç–æ—Ä—å **lag** (–æ—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ consumer'–æ–≤) ‚Äî Burrow, Kafka Exporter.
- –ù–µ –¥–µ–ª–∞–π –ø–∞—Ä—Ç–∏—Ü–∏–π —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ (overhead –Ω–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—é).
- –î–µ–ª–∞–π **–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É** ‚Äî Kafka –¥–∞—ë—Ç at-least-once.
- –ù–∞—Å—Ç—Ä–æ–π **retention** –ø–æ –æ–±—ä—ë–º—É –¥–∞–Ω–Ω—ã—Ö –∏ –≤—Ä–µ–º–µ–Ω–∏.

---

### üí° –í –æ–¥–Ω–æ–π —Ñ—Ä–∞–∑–µ

> **Kafka** ‚Äî —ç—Ç–æ –Ω–µ –æ—á–µ—Ä–µ–¥—å, –∞ **—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –∂—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π**,
> –≥–¥–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ö—Ä–∞–Ω—è—Ç—Å—è, –∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ —Å–∞–º–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç —á—Ç–µ–Ω–∏–µ–º.
> –ò–¥–µ–∞–ª–µ–Ω –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∏ stream processing.
