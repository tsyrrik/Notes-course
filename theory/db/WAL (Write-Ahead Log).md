**WAL** ‚Äî —ç—Ç–æ –∂—É—Ä–Ω–∞–ª –ø—Ä–µ–¥–∑–∞–ø–∏—Å–∏ (Write-Ahead Log),  
–æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ö–∞–Ω–∏–∑–º, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π **–Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å (durability)** –∏ **–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ** –≤ PostgreSQL.

–ü—Ä–∏–Ω—Ü–∏–ø –ø—Ä–æ—Å—Ç:

> –õ—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –∂—É—Ä–Ω–∞–ª (WAL),  
> –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –æ—Å–Ω–æ–≤–Ω—ã–º —Ñ–∞–π–ª–∞–º –¥–∞–Ω–Ω—ã—Ö.

---

### 1. –ó–∞—á–µ–º –Ω—É–∂–µ–Ω WAL

- üíæ **Crash safety** ‚Äî –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä —É–ø–∞–¥—ë—Ç, –±–∞–∑–∞ –º–æ–∂–µ—Ç ‚Äú–¥–æ–∏–≥—Ä–∞—Ç—å‚Äù WAL –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
    
- üîÅ **–†–µ–ø–ª–∏–∫–∞—Ü–∏—è** ‚Äî WAL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞ —Ä–µ–ø–ª–∏–∫–∏.
    
- üì¶ **–ë—ç–∫–∞–ø—ã** ‚Äî –º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –∏–∑ –±—ç–∫–∞–ø–∞ + WAL (—Ç–æ—á–∫–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏).
    
- ‚öôÔ∏è **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø–∏—Å–∏** ‚Äî –±–∞–∑–∞ –ø–∏—à–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤ –∂—É—Ä–Ω–∞–ª,  
    –∞ –Ω–µ –¥–µ–ª–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–µ I/O –ø–æ –≤—Å–µ–º—É –¥–∏—Å–∫—É.
    

---

### 2. –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ö–ª–∏–µ–Ω—Ç –¥–µ–ª–∞–µ—Ç `INSERT`, `UPDATE` –∏–ª–∏ `DELETE`.
    
2. PostgreSQL **–Ω–µ –ø–∏—à–µ—Ç** —Å—Ä–∞–∑—É –≤ —Ç–∞–±–ª–∏—Ü—É.
    
3. –û–Ω —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∑–∞–ø–∏—Å—å –≤ WAL, –æ–ø–∏—Å—ã–≤–∞—é—â—É—é, _—á—Ç–æ –∏–º–µ–Ω–Ω–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å_.
    
4. WAL –ø–∏—à–µ—Ç—Å—è **–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –Ω–∞ –¥–∏—Å–∫** (–≤ `pg_wal/`).
    
5. –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ø–∞–¥–∞—é—Ç –≤ shared buffers (—Å—Ç—Ä–∞–Ω–∏—Ü—ã –ë–î –≤ –ø–∞–º—è—Ç–∏).
    
6. –§–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å `checkpointer` –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç dirty-—Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ –¥–∏—Å–∫.
    

> –î–∞–∂–µ –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä —É–ø–∞–¥—ë—Ç –ø–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏ WAL,  
> –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ PostgreSQL ‚Äú–ø–µ—Ä–µ–∏–≥—Ä–∞–µ—Ç‚Äù –∂—É—Ä–Ω–∞–ª –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç –≤—Å–µ –∫–æ–º–º–∏—Ç—ã.

---

### 3. –ì–¥–µ –∂–∏–≤—ë—Ç WAL

–ö–∞—Ç–∞–ª–æ–≥:

```
$PGDATA/pg_wal/
```

–§–∞–π–ª—ã ‚Äî —Å–µ–≥–º–µ–Ω—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é **16 –ú–ë**, –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è –≤—Ä–æ–¥–µ:

```
00000001000000020000005B
```

–ö–∞–∂–¥—ã–π —Ñ–∞–π–ª ‚Äî –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –∫—É—Å–æ–∫ –∂—É—Ä–Ω–∞–ª–∞,  
–≤ –∫–æ—Ç–æ—Ä–æ–º —Ö—Ä–∞–Ω—è—Ç—Å—è –∑–∞–ø–∏—Å–∏ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö (insert, update, truncate –∏ —Ç.–¥.).

---

### 4. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ WAL-–∑–∞–ø–∏—Å–∏

–ö–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å –æ–ø–∏—Å—ã–≤–∞–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–∞–Ω–∏—Ü:

- **LSN (Log Sequence Number)** ‚Äî –ø–æ–∑–∏—Ü–∏—è –≤ WAL, —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä.
    
- **Transaction ID** ‚Äî —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è, –ø–æ—Ä–æ–¥–∏–≤—à–∞—è –∑–∞–ø–∏—Å—å.
    
- **–û–ø–∏—Å–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** (–Ω–∞–ø—Ä–∏–º–µ—Ä, ‚Äú–∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–±–ª–∏—Ü–µ N‚Äù).
    

> WAL –Ω–µ —Ö—Ä–∞–Ω–∏—Ç SQL-–∑–∞–ø—Ä–æ—Å, –∞ —Ç–æ–ª—å–∫–æ –±–∏–Ω–∞—Ä–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

---

### 5. Checkpoint –∏ WAL recycling

–ß—Ç–æ–±—ã –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å –∂—É—Ä–Ω–∞–ª –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ,  
Postgres –¥–µ–ª–∞–µ—Ç **checkpoint** ‚Äî —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç, –∫–∞–∫–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —É–∂–µ —Ç–æ—á–Ω–æ –Ω–∞ –¥–∏—Å–∫–µ.  
–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Å—Ç–∞—Ä—ã–µ WAL-—Å–µ–≥–º–µ–Ω—Ç—ã –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∏–ª–∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `postgresql.conf`:

```ini
checkpoint_timeout = 5min
max_wal_size = 1GB
min_wal_size = 80MB
```

> –ß–µ–º —á–∞—â–µ checkpoint ‚Äî —Ç–µ–º –º–µ–Ω—å—à–µ WAL, –Ω–æ –≤—ã—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –¥–∏—Å–∫.  
> –ß–µ–º —Ä–µ–∂–µ ‚Äî —Ç–µ–º –±–æ–ª—å—à–µ –∂—É—Ä–Ω–∞–ª, –Ω–æ –±—ã—Å—Ç—Ä–µ–µ –æ–±—ã—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞.

---

### 6. WAL –∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è

PostgreSQL —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç –Ω–µ ‚Äú–¥–∞–Ω–Ω—ã–µ‚Äù, –∞ –∏–º–µ–Ω–Ω–æ WAL.  
Master —Å—Ç—Ä–∏–º–∏—Ç –∑–∞–ø–∏—Å–∏ WAL —Ä–µ–ø–ª–∏–∫–∞–º,  
–∞ —Ç–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç –∏—Ö —É —Å–µ–±—è ‚Äî —ç—Ç–æ –∏ –µ—Å—Ç—å **streaming replication**.

> –†–µ–ø–ª–∏–∫–∞ –æ—Ç—Å—Ç–∞—ë—Ç? –ó–Ω–∞—á–∏—Ç, –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å WAL.  
> –°–º. `pg_stat_replication.lag`.

---

### 7. WAL –∏ Point-in-Time Recovery (PITR)

–ú–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ‚Äú–Ω–∞ –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ T‚Äù:

1. –°–¥–µ–ª–∞–π base backup (`pg_basebackup` –∏–ª–∏ snapshot).
    
2. –°–æ—Ö—Ä–∞–Ω–∏ –≤—Å–µ WAL, –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ.
    
3. –ü—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ ‚Äî ‚Äú–¥–æ–∏–≥—Ä–∞–π‚Äù WAL –¥–æ –Ω—É–∂–Ω–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ (`recovery_target_time`).
    

–≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è production:

> –ø–æ–∑–≤–æ–ª—è–µ—Ç ‚Äú–æ—Ç–∫–∞—Ç–∏—Ç—å‚Äù –æ—à–∏–±–∫—É —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –ø–æ–ª–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏.

---

### 8. WAL –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

|–ù–∞—Å—Ç—Ä–æ–π–∫–∞|–ó–Ω–∞—á–µ–Ω–∏–µ|–ß—Ç–æ –¥–µ–ª–∞–µ—Ç|
|---|---|---|
|`wal_level`|`minimal` / `replica` / `logical`|–û–±—ä—ë–º –¥–µ—Ç–∞–ª–µ–π, –∑–∞–ø–∏—Å—ã–≤–∞–µ–º—ã—Ö –≤ –∂—É—Ä–Ω–∞–ª|
|`synchronous_commit`|`on` / `off`|–ñ–¥–∞—Ç—å –ª–∏ fsync –ø–µ—Ä–µ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –∫–æ–º–º–∏—Ç–∞|
|`wal_compression`|`on`|–°–∂–∏–º–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã WAL|
|`wal_keep_size`|`256MB`|–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä WAL –¥–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏|
|`max_wal_senders`|`10`|–ö–æ–ª-–≤–æ –ø–æ—Ç–æ–∫–æ–≤ –¥–ª—è —Ä–µ–ø–ª–∏–∫|

> –ï—Å–ª–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –Ω–µ –Ω—É–∂–Ω–∞, `wal_level = minimal` –¥–∞—Å—Ç –ø—Ä–∏—Ä–æ—Å—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏.  
> –ù–æ –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ –∏ –±—ç–∫–∞–ø–æ–≤ –æ–±—ã—á–Ω–æ —Å—Ç–∞–≤—è—Ç `replica`.

---

### 9. WAL –≤ –¥—Ä—É–≥–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö

–ò–¥–µ—è **write-ahead log** –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –≤–µ–∑–¥–µ:

|–°–∏—Å—Ç–µ–º–∞|–ê–Ω–∞–ª–æ–≥ WAL|–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ|
|---|---|---|
|**MySQL (InnoDB)**|redo log|–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è|
|**Kafka**|commit log|—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π|
|**Redis (AOF)**|append-only file|–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞|
|**Elasticsearch**|translog|–∂—É—Ä–Ω–∞–ª –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏|
|**RabbitMQ**|message journal|–Ω–∞–¥—ë–∂–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π|
|**ClickHouse**|part mutations log|—Ñ–∏–∫—Å–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–∞–Ω–Ω—ã—Ö|

–í–µ–∑–¥–µ –∏–¥–µ—è –æ–¥–Ω–∞:  
**—Å–Ω–∞—á–∞–ª–∞ –ª–æ–≥ ‚Äî –ø–æ—Ç–æ–º –¥–µ–π—Å—Ç–≤–∏–µ**. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å.

---

### üí° –í –æ–¥–Ω–æ–π —Ñ—Ä–∞–∑–µ

> **WAL** ‚Äî —ç—Ç–æ ‚Äú—á–µ—Ä–Ω—ã–π —è—â–∏–∫‚Äù –±–∞–∑—ã,
> –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∫–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ,
> —á—Ç–æ–±—ã —Å–∏—Å—Ç–µ–º–∞ –º–æ–≥–ª–∞ –ø–µ—Ä–µ–∂–∏—Ç—å —Å–±–æ–π,
> –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Ä–µ–ø–ª–∏–∫–∞–º.

### –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- [[–†–µ–ø–ª–∏–∫–∞—Ü–∏—è (replication) –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö (–Ω–∞ –ø—Ä–∏–º–µ—Ä–µ PostgreSQL)]] ‚Äî –∫–∞–∫ WAL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π.
- [[MyISAM vs InnoDB]] ‚Äî —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–≤–∏–∂–∫–æ–≤ MySQL –∏ –∏—Ö –ø–æ–¥—Ö–æ–¥–æ–≤ –∫ –∂—É—Ä–Ω–∞–ª–∏—Ä–æ–≤–∞–Ω–∏—é.
