**–¢—Ä–∏–≥–≥–µ—Ä** ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º –≤ –°–£–ë–î, –∫–æ—Ç–æ—Ä—ã–π **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ**  
–≤ –æ—Ç–≤–µ—Ç –Ω–∞ **—Å–æ–±—ã—Ç–∏–µ** –≤ —Ç–∞–±–ª–∏—Ü–µ: –≤—Å—Ç–∞–≤–∫—É, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏.

–¢—Ä–∏–≥–≥–µ—Ä—ã –ø–æ–∑–≤–æ–ª—è—é—Ç **–≤—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –ø—Ä—è–º–æ –≤ –±–∞–∑—É**,  
—á—Ç–æ–±—ã –æ–Ω–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

---

### 1. –ü—Ä–∏–º–µ—Ä –Ω–∞ PostgreSQL

```sql
CREATE TABLE users (
    id serial PRIMARY KEY,
    email text NOT NULL,
    created_at timestamp DEFAULT now(),
    updated_at timestamp DEFAULT now()
);

-- —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é —Ç—Ä–∏–≥–≥–µ—Ä –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å
CREATE OR REPLACE FUNCTION set_updated_at()
RETURNS trigger AS $$
BEGIN
    NEW.updated_at := now();
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- —Ç—Ä–∏–≥–≥–µ—Ä –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
CREATE TRIGGER update_timestamp
BEFORE UPDATE ON users
FOR EACH ROW
EXECUTE FUNCTION set_updated_at();
```

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –ª—é–±–æ–º `UPDATE users ...` –ø–æ–ª–µ `updated_at` –æ–±–Ω–æ–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

---

### 2. –ö–æ–≥–¥–∞ —Ç—Ä–∏–≥–≥–µ—Ä —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç

|–í—Ä–µ–º—è|–û–ø–∏—Å–∞–Ω–∏–µ|
|---|---|
|**BEFORE**|–¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏ ‚Äî –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å `NEW` –∏–ª–∏ –æ—Ç–º–µ–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ|
|**AFTER**|–ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è ‚Äî —É–¥–æ–±–Ω–æ –¥–ª—è –ª–æ–≥–æ–≤, –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–π|
|**INSTEAD OF**|–∑–∞–º–µ–Ω—è–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è `VIEW`)|

–¢–∏–ø —Å–æ–±—ã—Ç–∏—è:

- `INSERT`
    
- `UPDATE`
    
- `DELETE`
    
- `TRUNCATE` (–≤ PostgreSQL —Ç–æ–∂–µ –º–æ–∂–Ω–æ)
    

---

### 3. –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º

–ö–æ–≥–¥–∞ —Ç—ã –¥–µ–ª–∞–µ—à—å, –Ω–∞–ø—Ä–∏–º–µ—Ä, `UPDATE`, Postgres:

1. –°—Ç—Ä–æ–∏—Ç –ø–ª–∞–Ω –∑–∞–ø—Ä–æ—Å–∞.
    
2. –ü–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å—Ç—Ä–æ–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç **BEFORE-—Ç—Ä–∏–≥–≥–µ—Ä—ã** (–µ—Å–ª–∏ –µ—Å—Ç—å).
    
    - –æ–Ω–∏ –º–æ–≥—É—Ç –∏–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (`NEW`) –∏–ª–∏ –≤—ã–±—Ä–æ—Å–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ.
        
3. –í—ã–ø–æ–ª–Ω—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ.
    
4. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤—ã–∑—ã–≤–∞–µ—Ç **AFTER-—Ç—Ä–∏–≥–≥–µ—Ä—ã**, –ø–µ—Ä–µ–¥–∞–≤–∞—è —Å—Ç–∞—Ä—ã–µ –∏ –Ω–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (`OLD`, `NEW`).
    

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç—Ä–∏–≥–≥–µ—Ä–∞ –°–£–ë–î —Ö—Ä–∞–Ω–∏—Ç:

- —É—Å–ª–æ–≤–∏–µ (event + timing + table);
    
- —Å—Å—ã–ª–∫—É –Ω–∞ —Ñ—É–Ω–∫—Ü–∏—é;
    
- –∫–æ–Ω—Ç–µ–∫—Å—Ç (`OLD`, `NEW`, `TG_OP`, `TG_TABLE_NAME`).
    

–¢—Ä–∏–≥–≥–µ—Ä—ã –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è:

- **FOR EACH ROW** ‚Äî –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏;
    
- **FOR EACH STATEMENT** ‚Äî –æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ –≤–µ—Å—å –∑–∞–ø—Ä–æ—Å.
    

---

### 4. AFTER vs BEFORE

|–¢–∏–ø|–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏|
|---|---|
|**BEFORE**|–ú–æ–∂–Ω–æ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `NEW` –∏–ª–∏ –æ—Ç–º–µ–Ω–∏—Ç—å (`RETURN NULL`)|
|**AFTER**|–î–∞–Ω–Ω—ã–µ —É–∂–µ –∑–∞–ø–∏—Å–∞–Ω—ã ‚Äî —É–¥–æ–±–Ω–æ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π|
|**INSTEAD OF**|–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è `VIEW`, –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ|

---

### 5. –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏

```sql
BEFORE UPDATE ON users
EXECUTE FUNCTION set_updated_at();
```

#### ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

```sql
CREATE OR REPLACE FUNCTION log_update()
RETURNS trigger AS $$
BEGIN
  INSERT INTO users_log(user_id, old_email, new_email, changed_at)
  VALUES (OLD.id, OLD.email, NEW.email, now());
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER users_audit
AFTER UPDATE ON users
FOR EACH ROW
EXECUTE FUNCTION log_update();
```

#### ‚úÖ –ö–∞—Å–∫–∞–¥–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

–ù–∞–ø—Ä–∏–º–µ—Ä, —É–¥–∞–ª—è—Ç—å –¥–æ—á–µ—Ä–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ä–æ–¥–∏—Ç–µ–ª—è ‚Äî  
–Ω–æ –æ–±—ã—á–Ω–æ –ª—É—á—à–µ –¥–µ–ª–∞—Ç—å —á–µ—Ä–µ–∑ `ON DELETE CASCADE`, –Ω–µ —á–µ—Ä–µ–∑ —Ç—Ä–∏–≥–≥–µ—Ä—ã.

---

### 6. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

‚ö†Ô∏è **–°–∫—Ä—ã—Ç–∞—è –ª–æ–≥–∏–∫–∞:**  
—Ç—Ä–∏–≥–≥–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç ‚Äú–∑–∞ –∫–∞–¥—Ä–æ–º‚Äù ‚Äî –ª–µ–≥–∫–æ –∑–∞–±—ã—Ç—å, —á—Ç–æ –æ–Ω–∏ –µ—Å—Ç—å.

‚ö†Ô∏è **–†–µ–∫—É—Ä—Å–∏—è:**  
–µ—Å–ª–∏ —Ç—Ä–∏–≥–≥–µ—Ä –≤—ã–∑—ã–≤–∞–µ—Ç `UPDATE` –Ω–∞ —Ç—É –∂–µ —Ç–∞–±–ª–∏—Ü—É ‚Üí –∑–∞—Ü–∏–∫–ª–∏—Ç—Å—è.  
(–≤ PostgreSQL –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å `DISABLE TRIGGER ALL` –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π).

‚ö†Ô∏è **–°–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å –æ—Ç–ª–∞–¥–∫–æ–π:**  
–Ω–µ –≤—Å–µ–≥–¥–∞ –æ—á–µ–≤–∏–¥–Ω–æ, –ø–æ—á–µ–º—É –∑–∞–ø—Ä–æ—Å —Å—Ç–∞–ª –º–µ–¥–ª–µ–Ω–Ω—ã–º ‚Äî —Ç—Ä–∏–≥–≥–µ—Ä –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∏–Ω–æ–≤–∞—Ç.

‚ö†Ô∏è **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å:**  
–≤—Å—ë, —á—Ç–æ –¥–µ–ª–∞–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä, —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –æ–±—â–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.  
–ï—Å–ª–∏ —Ç—Ä–∏–≥–≥–µ—Ä —É–ø–∞–ª ‚Äî –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤–µ—Å—å –∑–∞–ø—Ä–æ—Å.

---

### 7. –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ —É–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤

```sql
-- —Å–ø–∏—Å–æ–∫ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
SELECT tgname, tgrelid::regclass, tgenabled
FROM pg_trigger
WHERE NOT tgisinternal;

-- —É–¥–∞–ª–∏—Ç—å
DROP TRIGGER update_timestamp ON users;
```

---

### 8. –ö–æ–≥–¥–∞ —Ç—Ä–∏–≥–≥–µ—Ä—ã —Ä–µ–∞–ª—å–Ω–æ –ø–æ–ª–µ–∑–Ω—ã

‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ä—É—Ç–∏–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ timestamps).  
‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π.  
‚úÖ –ê—É–¥–∏—Ç, –∏—Å—Ç–æ—Ä–∏—è –≤–µ—Ä—Å–∏–π.  
‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü –∏–ª–∏ –∫—ç—à–µ–π.

üö´ –ù–µ —Å—Ç–æ–∏—Ç:

- —Ö—Ä–∞–Ω–∏—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤;
    
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –≤–º–µ—Å—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å);
    
- –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É, –∫–æ—Ç–æ—Ä–∞—è —É–∂–µ –µ—Å—Ç—å –≤ –∫–æ–¥–µ.
    

